<!doctype html>
<html lang="en">
<head>
  <title>Oriøn Assistant Window</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0">
  <style>
    @font-face { font-family: Name; src: url('Data/Fonts/Name.ttf'); }
    @font-face { font-family: Main; src: url('Data/Fonts/Main.ttf'); }
    @font-face { font-family: Special; src: url('Data/Fonts/Special.ttf'); }
  
    html {
      height: 100%;
      width: 100%;
      background: #000;
      scroll-behavior: smooth;
      color: var(--textPrimary);
      font-family: Main;
  
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    body {
      height: 100%; 
      width: 100%; 
      margin: 0; 
      padding: 0;
      overflow: hidden;

      /*THEME*/
      --menu: transparent;
      --background: transparent;
      --scrollbar: transparent;
      --selection: transparent;
      /*TEXT*/
      --textAppName: transparent;
      --textPrimary: transparent;
      --textSecondary: transparent;
      /*SHADOWS*/
      --shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
      --shadowBig: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(126, 126, 126, 0.2) 0px 0px 0px 1px;
      /*STORE*/
      --searching: #C7C9CA;
      --positive: #00d12d;
      --negative: #C70039;
      /*TITLE BAR BUTTONS*/
      --topText: transparent;
      --topHover: transparent;
      --topExitHover: transparent;
      /*MODULE*/
      --module: transparent;
      --moduleImageFilter: brightness(100%); /*https://angel-rs.github.io/css-color-filter-generator/*/
      --moduleCornerRadius: 0px;
      /*BUTTON*/
      --button: transparent;
      --buttonHover: transparent;
      --buttonBorder: transparent;
      --buttonCornerRadius: 0px;
      /*RADIO*/
      --radio: transparent;
      /*SWITCH*/
      --switchUnchecked: transparent;
      --switchChecked: transparent;
    }

    img {
      -webkit-user-drag: none;
    }

    ::selection {
      background: var(--selection);
    }
    
    /*CONTAINERS*/
    .hc {
      display: flex;
      flex-direction: row;
    }

    .vc {
      display: flex;
      flex-direction: column;
    }
    
    /*SCROLLBAR*/
    ::-webkit-scrollbar {
      width: 14px;
      height: 14px;
    }	

    ::-webkit-scrollbar-thumb {
      background: var(--scrollbar);
      border: solid 4px transparent;
      border-radius: 7px;
      background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
      border: solid 3px transparent;
    }

    .invisible-scrollbar {
      overflow-x: hidden;
      overflow-y: scroll;
    }

    .invisible-scrollbar::-webkit-scrollbar {
      width: 0;
      height: 0;
    }
  
    /*MINI MAXI CLOSE BUTTONS*/
    .button-top {
      width: 30px; 
      height: 20px; 
      transition: all .2s, width 0s;
      overflow: hidden;
      line-height: 20px;
      font-size: 12px; 
      text-align: center;
      font-family: Arial, Helvetica, sans-serif;
      color: var(--topText);
      background: transparent;
    }
  
    .button-top:hover {
      background: var(--topHover);
    }

    .button-exit:hover {
      background: var(--topExitHover);
    }
  
    /*UP ANIMATION BUTTON*/
    .button-elevated {
      transition: transform .2s;
    }
  
    .button-elevated:hover {
      transform: translateY(-3px);
    }

    /*MODULE*/
    .module {
      width: 60px;
      height: 60px;
      position: relative;
      color: var(--textPrimary);
    }
    
    .module div:nth-of-type(2) {
      width: inherit;
      height: inherit;
      transition: all .2s;
      background: transparent;
      border-radius: var(--moduleCornerRadius);
    }

    .module div:nth-of-type(2) img {
      width: 26px;
      height: 26px;
      margin: 17px;
      filter: var(--moduleImageFilter);
      pointer-events: none;
      object-fit: contain;
    }

    .module div:nth-of-type(1) {
      width: min-content;
      height: fit-content;
      margin-top: 5px;
      position: absolute;
      padding: 5px;
      opacity: 0;
      z-index: 999;
      pointer-events: none;
      font-size: 14px;
      color: inherit;
      background: var(--module);
      border-radius: var(--moduleCornerRadius);
      box-shadow: var(--shadow);
      transition: all 0s;
      transition-delay: 0s;
    }

    .module input {
      width: 60px;
      height: 60px;
      margin: 0;
      position: absolute;
      opacity: 0;
    }

    .module input:checked ~ div:nth-of-type(2) {
      background: var(--module);
      box-shadow: var(--shadow);
    }

    .module input:hover ~ div:nth-of-type(2) {
      background: var(--module);
      box-shadow: var(--shadow);
    }

    .module input:hover ~ div:nth-of-type(1) {
      opacity: 1;
      transition: all .2s;
      transition-delay: 1s;
    }

    /*BUTTON*/
    .button {
      transition: all .2s;
      overflow: hidden;
      color: var(--textPrimary);
      fill: var(--textPrimary);
      background: var(--button);
      outline: var(--buttonBorder);
      outline-offset: -1px;
      border-radius: var(--buttonCornerRadius);
      box-shadow: var(--shadow);
    }
  
    .button:hover {
      background: var(--buttonHover);
    }

    /*BUTTON TEXT*/
    .buttonText {
      font-size: 15px;
      line-height: 40px;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-family: Main;
      color: var(--textPrimary);
    }

    .buttonEmoteText {
      font-size: 20px;
      line-height: 40px;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-family: Arial, Monospaced;
      color: var(--textPrimary);
      text-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }

    .buttonSVG {
      width: 26px;
      height: 26px; 
      margin: 7px;
    }
    
    /*INPUT TEXT*/
    .input {
      height: 40px;
      padding-top: 0;
      padding-bottom: 0;
      padding-left: 10px;
      padding-right: 10px;
      font-size: 15px;
      line-height: 40px;
      font-family: Main;
      color: inherit;
      background: transparent;
      border: 0;
    }
  
    .input::placeholder {
      color: var(--textSecondary);
    }
  
    .input:focus {
      outline: none;
    }

    /*RADIO*/
    .radio {
      width: 30px;
      height: 30px;
      margin-top: 5px;
      margin-bottom: 5px;
      position: relative;
      border-radius: 15px;
    }

    .radio input {
      width: inherit;
      height: inherit;
      margin: 0;
      position: absolute;
      opacity: 0;
    }

    .radio div {
      width: 10px;
      height: 10px;
      margin: 10px;
      transition: all .2s;
      background: var(--radio);
      pointer-events: none;
      border-radius: 5px;
      opacity: 0;
    }

    .radio input:checked ~ div {
      opacity: 1;
    }

    /*SWITCH*/
    .switch {
      width: 50px;
      height: 30px;
      margin-top: 5px;
      margin-bottom: 5px;
      position: relative;
      border-radius: 15px;
    }

    .switch input {
      width: inherit;
      height: inherit;
      margin: 0;
      position: absolute;
      opacity: 0;
    }

    .switch div {
      width: 10px;
      height: 10px;
      margin: 10px;
      transition: all .2s;
      background: var(--switchUnchecked); 
      pointer-events: none;
      border-radius: 5px;
    }

    .switch input:checked ~ div {
      transform: translate3d(200%, 0, 0);
      background: var(--switchChecked);
    }

    /*SWITCH EMOTE*/
    .switch-custom {
      width: 80px;
      height: 40px;
      transition: all .2s;
      position: relative;
      display: flex;
    }

    .switch-custom input {
      width: inherit;
      height: inherit;
      position: absolute;
      opacity: 0;
    }

    .switch-custom div:nth-of-type(1) {
      height: calc(100% - 10px);
      width: calc(50% - 10px);
      margin: 5px;
      position: relative;
      transition: all .2s;
      background: var(--switchUnchecked);
      border-radius: inherit;
    }

    .switch-custom input:checked ~ div:nth-of-type(1) {
      transform: translateX(calc(100% + 10px));
    }

    .switch-custom div {
      height: inherit;
      width: 50%;
      position: absolute;
      pointer-events: none;
    }

    .switch-custom div:nth-of-type(3) {
      height: inherit;
      width: 50%;
      pointer-events: none;
      transform: translateX(100%);
    }

    /*CONTEXT MENU*/
    .cmenu {
      width: 200px;
      padding: 10px 0;
      top: 0px;
      left: 0px;
      position: fixed;
      background: var(--button);
      outline: var(--buttonBorder);
      outline-offset: -1px;
      border-radius: var(--buttonCornerRadius);
      box-shadow: var(--shadow);
    }

    .cmenu-item {
      width: 170px;
      padding: 5px 15px;
      transition: all .2s, visibility 0s;
      align-items: center;
      font-size: 15px;
      line-height: normal;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      fill: var(--textPrimary);
      color: var(--textPrimary);
      background: var(--button);
    }
  
    .cmenu-item:hover {
      background: var(--buttonHover);
    }
  </style>
</head>

<div id="themeDiv" style="display: none;"></div>

<body class="vc" style="background: var(--background);">
  <div class="hc" style="width: 100%; height: 20px; background: var(--menu);">
    <div id="nameDisplay" style="width: fit-content; height: 20px; margin: 0 5px; text-align: center; position: absolute; font-family: Name; color: var(--textAppName);">Oriøn Assistant</div>
    <div style="flex-grow: 1; height: 15px; margin-top: 5px; -webkit-app-region: drag;"></div>
    <div id="exit" class="button-top button-exit">✕</div>
  </div>
  
  <div class="hc" style="width: 100%; height: calc(100% - 20px); position: relative;">
    <div id="wall" style="width: 100%; height: 100%; position: absolute; display: none; z-index: 99999;"></div>

    <div id="removeWindow" class="vc" style="flex-grow: 1; height: 100%; display: none;">
      <div id="removeWindowTitle" style="height: 20px; margin: 20px; color: var(--textPrimary); font-size: 17px;">Title</div>
      <div class="hc" style="width: 100%; position: absolute; bottom: 20px;align-items: center; justify-content: center;">
        <div id="removeWindowRemove" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px; margin-right: 10px;">Remove</div>
        <div id="removeWindowCancel" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px;">Cancel</div>
      </div>
    </div>
    
    <div id="windowBackground" class="vc" style="flex-grow: 1; height: 100%; overflow-y: auto;">
      <div id="window" class="vc" style="flex-grow: 1; overflow-anchor: none;"></div>
    </div>
  </div>
  
  <div id="context-menu" class="cmenu vc" style="visibility: hidden;">
    <div id="context-menu-cut" class="cmenu-item">
      <svg class="buttonSVG" viewBox="0 0 24 24" style="margin: 0 10px 0 0;">
        <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM17.76 14.68C18.09 14.93 18.16 15.4 17.91 15.73C17.76 15.93 17.54 16.03 17.31 16.03C17.15 16.03 17 15.98 16.86 15.88L12.91 12.93L10.5 14.73C10.51 14.83 10.53 14.93 10.53 15.03C10.53 16.3 9.5 17.33 8.23 17.33C6.96 17.33 5.93 16.3 5.93 15.03C5.93 13.76 6.96 12.73 8.23 12.73C8.85 12.73 9.4 12.98 9.81 13.37L11.65 11.99L9.82 10.62C9.41 11.02 8.84 11.27 8.22 11.27C6.95 11.27 5.92 10.24 5.92 8.97C5.92 7.7 6.95 6.67 8.22 6.67C9.49 6.67 10.52 7.7 10.52 8.97C10.52 9.07 10.5 9.16 10.49 9.25L12.89 11.05L16.84 8.1C17.17 7.85 17.64 7.92 17.89 8.25C18.14 8.58 18.07 9.05 17.74 9.3L14.14 11.99L17.76 14.68Z"/>
      </svg>
      Cut
    </div>
    <div id="context-menu-copy" class="cmenu-item">
      <svg class="buttonSVG" viewBox="0 0 24 24" style="margin: 0 10px 0 0;">
        <path d="M16 12.9V17.1C16 20.6 14.6 22 11.1 22H6.9C3.4 22 2 20.6 2 17.1V12.9C2 9.4 3.4 8 6.9 8H11.1C14.6 8 16 9.4 16 12.9Z"/>
        <path d="M17.0998 2H12.8998C9.81668 2 8.37074 3.09409 8.06951 5.73901C8.00649 6.29235 8.46476 6.75 9.02167 6.75H11.0998C15.2998 6.75 17.2498 8.7 17.2498 12.9V14.9781C17.2498 15.535 17.7074 15.9933 18.2608 15.9303C20.9057 15.629 21.9998 14.1831 21.9998 11.1V6.9C21.9998 3.4 20.5998 2 17.0998 2Z"/>
      </svg>
      Copy
    </div>
    <div id="context-menu-paste" class="cmenu-item">
      <svg class="buttonSVG" viewBox="0 0 24 24" style="margin: 0 10px 0 0;">
        <path d="M14.3498 2H9.64977C8.60977 2 7.75977 2.84 7.75977 3.88V4.82C7.75977 5.86 8.59977 6.7 9.63977 6.7H14.3498C15.3898 6.7 16.2298 5.86 16.2298 4.82V3.88C16.2398 2.84 15.3898 2 14.3498 2Z"/>
        <path d="M17.2391 4.81949C17.2391 6.40949 15.9391 7.70949 14.3491 7.70949H9.64906C8.05906 7.70949 6.75906 6.40949 6.75906 4.81949C6.75906 4.25949 6.15906 3.90949 5.65906 4.16949C4.24906 4.91949 3.28906 6.40949 3.28906 8.11949V17.5295C3.28906 19.9895 5.29906 21.9995 7.75906 21.9995H16.2391C18.6991 21.9995 20.7091 19.9895 20.7091 17.5295V8.11949C20.7091 6.40949 19.7491 4.91949 18.3391 4.16949C17.8391 3.90949 17.2391 4.25949 17.2391 4.81949ZM12.3791 16.9495H7.99906C7.58906 16.9495 7.24906 16.6095 7.24906 16.1995C7.24906 15.7895 7.58906 15.4495 7.99906 15.4495H12.3791C12.7891 15.4495 13.1291 15.7895 13.1291 16.1995C13.1291 16.6095 12.7891 16.9495 12.3791 16.9495ZM14.9991 12.9495H7.99906C7.58906 12.9495 7.24906 12.6095 7.24906 12.1995C7.24906 11.7895 7.58906 11.4495 7.99906 11.4495H14.9991C15.4091 11.4495 15.7491 11.7895 15.7491 12.1995C15.7491 12.6095 15.4091 12.9495 14.9991 12.9495Z"/>
      </svg>
      Paste
    </div>
  </div>
</body>

<script>
  const { app, ipcRenderer, shell } = require('electron')
  window.$ = window.jQuery = require('jquery')
  const fs = require('fs')

  //DATA
  let win = null
  let data = {} //root, data, zip, modules (folder paths)
  let json = null
  let specialData = null
  let removePaths = []

  win = require('@electron/remote').getCurrentWindow()

  $("#themeDiv").load('Data\\theme.html', function(){
    win.setOpacity(1)
  })

  ipcRenderer.on('load', (event, file, argData, argSpecialData) => {
    data = argData
    refreshData()
    specialData = argSpecialData

    //LAOD FILE
    $("#window").load(file.replaceAll(' ', '%20'))
  })

  //CONTEXT MENU
  const cmenu = document.getElementById('context-menu')
  $(window).bind('contextmenu', function(event) {
    cmenu.style.visibility = 'hidden'
    const target = event.target
    event.preventDefault()
    //GET SELECTION
    let selection = ''
    if (window.getSelection) {
      selection = window.getSelection()
    } else if (document.getSelection) {
      selection = document.getSelection()
    } else if (document.selection) {
      selection = document.selection.createRange().text
    }
    let selectionStr = selection.toString()
    //SHOW BUTTONS
    document.getElementById('context-menu-cut').style.display = 'none'
    document.getElementById('context-menu-copy').style.display = 'none'
    document.getElementById('context-menu-paste').style.display = 'none'
    switch (target.tagName) {
      case 'INPUT':
        document.getElementById('context-menu-paste').style.display = 'flex'
        if (selectionStr != '') {
          document.getElementById('context-menu-cut').style.display = 'flex'
          document.getElementById('context-menu-copy').style.display = 'flex'
        }
        break
      default:
        //IS THE SELECTED ELEMENT
        try {
          if (target != selection.baseNode.parentNode) return
          if (selectionStr != '')
            document.getElementById('context-menu-copy').style.display = 'flex'
          else
            return
        } catch (e) {
          return
        }
        break
    }
    //GET MOUSE POSITION & SIZES
    const { clientX: mouseX, clientY: mouseY } = event
    const { width: winW, height: winH } = win.getBounds()
    const menuW = cmenu.clientWidth+1
    const menuH = cmenu.clientHeight+1
    //OVERFLOW
    let posX = mouseX
    if (mouseX + menuW > winW) posX = winW-menuW
    let posY = mouseY
    if (mouseY + menuH > winH) posY = winH-menuH
    //MOVE & SHOW MENU
    cmenu.style.left = posX+'px'
    cmenu.style.top = posY+'px'
    cmenu.style.visibility = 'visible'
    //LISTENERS
    $('#context-menu-cut').unbind()
    $('#context-menu-copy').unbind()
    $('#context-menu-paste').unbind()
    addButtonListener('context-menu-cut', async function() {
      cmenu.style.visibility = 'hidden'
      const ss = target.selectionStart
      const se = target.selectionEnd
      if (ss != undefined && se != undefined) {
        //CUT SELECTION
        target.value = target.value.slice(0, ss)+target.value.slice(se)
        navigator.clipboard.writeText(selectionStr).then((err) => { if (err) createNoti('Assistant:', "Couldn't Copy: "+err) })
      }
    })
    addButtonListener('context-menu-copy', function() {
      cmenu.style.visibility = 'hidden'
      //COPY SELECTION
      navigator.clipboard.writeText(selectionStr).then((err) => { if (err) createNoti('Assistant:', "Couldn't Copy: "+err) })
    })
    addButtonListener('context-menu-paste', async function() {
      cmenu.style.visibility = 'hidden'
      const clip = await navigator.clipboard.readText()
      const ss = target.selectionStart
      const se = target.selectionEnd
      if (ss != undefined && se != undefined) {
        //PASTE FROM SELECTION START TO END
        target.value = target.value.slice(0, ss)+clip+target.value.slice(se)
      } else if (ss != undefined)
        //PASTE AT SELECTION START
        target.value = target.value.slice(0, ss)+clip+target.value.slice(ss)
      else
        //NO SELECTION => PASTE AT END
        target.value = target.value+clip
    })
  })
  
  $(window).bind('click', function(e) {
    if (e.target.offsetParent != cmenu)
      cmenu.style.visibility = 'hidden'
  })

  //REMOVE WINDOW
  let windowH = 0
  function showRemoveWindow(argPaths) {
    document.getElementById('window').style.display = 'none'
    document.getElementById('removeWindow').style.display = 'flex'

    let size = win.getSize()
    windowH = size[1]
    win.setResizable(true)
    win.setSize(390, 150)
    win.setResizable(false)
    win.center()

    removePaths = argPaths
    if (removePaths.length == 1) {
      let path = removePaths[0]
      if (path.endsWith('.txt')) path = path.slice(0,-4)
      document.getElementById('removeWindowTitle').innerText = 'Remove "' + path.substring(path.lastIndexOf('\\')+1) + '"?'
    } else {
      document.getElementById('removeWindowTitle').innerText = 'Remove ' + removePaths.length + ' Games/Folders?'
    }
  }

  addButtonListener('removeWindowRemove', function() {
    for (i in removePaths) {
      let path = removePaths[i]
      if (fs.existsSync(path)) {
        if (fs.statSync(path).isFile()) {
          fs.unlink(path, (err) => {
            if (i == removePaths.length-1) {
              closeWindow(json.actualPath)
            }
          })
        } else {
          const rimraf = require("rimraf")
          rimraf(path, (err) => {
            if (i == removePaths.length-1) {
              closeWindow(json.actualPath)
            }
          })
        }
      } else if (i == removePaths.length-1) {
        closeWindow()
      }
    }
  })

  addButtonListener('removeWindowCancel', function() {
    document.getElementById('window').style.display = 'flex'
    document.getElementById('removeWindow').style.display = 'none'
    win.setResizable(true)
    win.setSize(390, windowH)
    win.setResizable(false)
    win.center()
  })

  //DATA FUNCTIONS
  function refreshData() {
  let jsonPath = data.data+'settings.json'
  if (fs.existsSync(jsonPath)) 
    json = JSON.parse(fs.readFileSync(jsonPath))
  else {
    json = {}
    fs.writeFile(jsonPath, '{}', function(err) {if (err) console.log(err)})
  }
}

  function setData(key, value) {
    refreshData()
    json[key] = value
    fs.writeFileSync(data.data+'settings.json', JSON.stringify(json));
  }

  //OTHER
  function closeWindow(specialData) {
    if (specialData != undefined) ipcRenderer.send('specialData', specialData)
    win.close()
  }

  addButtonListener('exit', function() {
    closeWindow()
  })

  //BUTTON LISTENERS
  function addButtonListener(id, click) {
    $('#'+id).bind('click', function() {
      if (event.which != 1) return
      click()
    })
  }

  function addCustomButtonListener(id, mousedown, mouseup, click) {
    $('#'+id).bind('mousedown', function() {
      if (event.which != 1) return
      mousedown()
    })

    $(window).bind('mouseup', function() {
      if (event.which != 1) return
      mouseup()
    })

    $('#'+id).bind('click', function() {
      if (event.which != 1) return
      click()
    })
  }

  function addRightButtonListener(id, click) {
    $('#'+id).bind('contextmenu', function() {
      if (event.which != 3) return
      click()
    })
  }
  
  function addCheckboxListener(id, checked, unchecked) {
    $('#'+id).bind('change', function() {
      if (this.checked)
        checked()
      else 
        unchecked()
    })
  }
</script>
</html>