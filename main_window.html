<!doctype html>
<html lang="en">
<head>
  <title>Oriøn Assistant Window</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0">
  <style>
    @font-face { font-family: Name; src: url('Data/Fonts/Name.ttf'); }
    @font-face { font-family: Main; src: url('Data/Fonts/Main.ttf'); }
    @font-face { font-family: Special; src: url('Data/Fonts/Special.ttf'); }
  
    html {
      height: 100%;
      width: 100%;
      background: #000;
      scroll-behavior: smooth;
      color: var(--textPrimary);
      font-family: Main;
  
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    body {
      height: 100%; 
      width: 100%; 
      margin: 0; 
      padding: 0;
      overflow: hidden;

      /*THEME*/
      --menu: transparent;
      --background: transparent;
      --scrollbar: transparent;
      --selection: transparent;
      /*TITLE BAR BUTTONS*/
      --topText: transparent;
      --topHover: transparent;
      --topExitHover: transparent;
      /*MODULE*/
      --module: transparent;
      --moduleImageFilter: brightness(100%);
      --moduleCornerRadius: 0px;
      /*BUTTON*/
      --button: transparent;
      --buttonHover: transparent;
      --buttonBorder: transparent;
      --buttonCornerRadius: 0px;
      /*RADIO*/
      --radio: transparent;
      /*SWITCH*/
      --switchUnchecked: transparent;
      --switchChecked: transparent;
      /*TEXT*/
      --appName: transparent;
      --textPrimary: transparent;
      --textSecondary: transparent;
    }

    img {
      -webkit-user-drag: none;
    }

    ::selection {
      background: var(--selection);
    }
    
    /*CONTAINERS*/
    .hc {
      display: flex;
      flex-direction: row;
    }

    .vc {
      display: flex;
      flex-direction: column;
    }
    
    /*SCROLLBAR*/
    ::-webkit-scrollbar {
      width: 14px;
      height: 14px;
    }	

    ::-webkit-scrollbar-thumb {
      background: var(--scrollbar);
      border: solid 4px transparent;
      border-radius: 7px;
      background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
      border: solid 3px transparent;
    }

    .invisible-scrollbar {
      overflow-x: hidden;
      overflow-y: scroll;
    }

    .invisible-scrollbar::-webkit-scrollbar {
      width: 0;
      height: 0;
    }
  
    /*MINI MAXI CLOSE BUTTONS*/
    .button-top {
      width: 30px; 
      height: 20px; 
      transition: all .2s, width 0s;
      overflow: hidden;
      line-height: 20px;
      font-size: 12px; 
      text-align: center;
      font-family: Arial, Helvetica, sans-serif;
      color: var(--topText);
      background: transparent;
    }
  
    .button-top:hover {
      background: var(--topHover);
    }

    .button-exit:hover {
      background: var(--topExitHover);
    }
  
    /*UP ANIMATION BUTTON*/
    .button-elevated {
      transition: transform .2s;
    }
  
    .button-elevated:hover {
      transform: translateY(-3px);
    }

    /*MODULE*/
    .module {
      width: 60px;
      height: 60px;
      margin-top: 10px;
      position: relative;
    }

    .module div:nth-of-type(1) {
      width: inherit;
      height: inherit;
      transition: all .2s;
      background: transparent;
      border-radius: var(--moduleCornerRadius);
    }

    .module div:nth-of-type(1) img {
      width: 26px;
      height: 26px;
      margin: 17px;
      filter: var(--moduleImageFilter);
      pointer-events: none;
      object-fit: contain;
    }

    .module div:nth-of-type(2) {
      width: min-content;
      height: fit-content;
      margin-top: 5px;
      position: absolute;
      padding: 5px;
      opacity: 0;
      z-index: 999;
      pointer-events: none;
      font-size: 14px;
      color: var(--textPrimary);
      background: var(--module);
      border-radius: var(--moduleCornerRadius);
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
      transition: all 0s;
      transition-delay: 0s;
    }

    .module input {
      width: 60px;
      height: 60px;
      margin: 0;
      position: absolute;
      opacity: 0;
    }

    .module input:checked ~ div:nth-of-type(1) {
      background: var(--module);
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }

    .module input:hover ~ div:nth-of-type(1) {
      background: var(--module);
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }

    .module input:hover ~ div:nth-of-type(2) {
      opacity: 1;
      transition: all .2s;
      transition-delay: 1s;
    }

    /*BUTTON*/
    .button {
      transition: all .2s;
      overflow: hidden;
      color: var(--textPrimary);
      background: var(--button);
      outline: 1px solid var(--buttonBorder);
      outline-offset: -1px;
      border-radius: var(--buttonCornerRadius);
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }
  
    .button:hover {
      background: var(--buttonHover);
    }

    /*BUTTON TEXT*/
    .buttonText {
      font-size: 15px;
      line-height: 40px;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-family: Main;
      color: var(--textPrimary);
    }

    .buttonEmoteText {
      font-size: 20px;
      line-height: 40px;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-family: Arial, Monospaced;
      color: var(--textPrimary);
      text-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }
    
    /*INPUT TEXT*/
    .input {
      height: 40px;
      padding-top: 0;
      padding-bottom: 0;
      padding-left: 10px;
      padding-right: 10px;
      font-size: 15px;
      line-height: 40px;
      font-family: Main;
      color: inherit;
      background: transparent;
      border: 0;
    }
  
    .input::placeholder {
      color: var(--textSecondary);
    }
  
    .input:focus {
      outline: none;
    }

    /*RADIO*/
    .radio {
      width: 30px;
      height: 30px;
      margin-top: 5px;
      margin-bottom: 5px;
      position: relative;
      border-radius: 15px;
    }

    .radio input {
      width: inherit;
      height: inherit;
      margin: 0;
      position: absolute;
      opacity: 0;
    }

    .radio div {
      width: 10px;
      height: 10px;
      margin: 10px;
      transition: all .2s;
      background: var(--radio);
      pointer-events: none;
      border-radius: 5px;
      opacity: 0;
    }

    .radio input:checked ~ div {
      opacity: 1;
    }

    /*SWITCH*/
    .switch {
      width: 50px;
      height: 30px;
      margin-top: 5px;
      margin-bottom: 5px;
      position: relative;
      border-radius: 15px;
    }

    .switch input {
      width: inherit;
      height: inherit;
      margin: 0;
      position: absolute;
      opacity: 0;
    }

    .switch div {
      width: 10px;
      height: 10px;
      margin: 10px;
      transition: all .2s;
      background: var(--switchUnchecked); 
      pointer-events: none;
      border-radius: 5px;
    }

    .switch input:checked ~ div {
      transform: translate3d(200%, 0, 0);
      background: var(--switchChecked);
    }

    /*SWITCH EMOTE*/
    .switch-emote {
      width: 80px;
      height: 40px;
      transition: all .2s;
      position: relative;
      display: flex;
    }

    .switch-emote input {
      width: inherit;
      height: inherit;
      position: absolute;
      opacity: 0;
    } 
    
    .switch-emote div {
      height: inherit;
      color: inherit;
      background: transparent;
      pointer-events: none;
    }

    .switch-emote div:first-of-type {
      height: inherit;
      position: absolute;
      top: 0;
      transition: all .2s;
      background: var(--buttonHover);
      border-radius: inherit;
      transform: translate3d(100%, 0, 0);
      box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
    }

    .switch-emote input:checked + div:first-of-type {
      transform: translate3d(0, 0, 0);
    }
  </style>
</head>

<div id="themeDiv" style="display: none;"></div>

<body class="vc" style="background: var(--background);">
  <div class="hc" style="width: 100%; height: 20px; background: var(--menu);">
    <div id="nameDisplay" style="width: fit-content; height: 20px; margin: 0 5px; text-align: center; position: absolute; font-family: Name; color: var(--appName);">Oriøn Assistant</div>
    <div style="flex-grow: 1; height: 15px; margin-top: 5px; -webkit-app-region: drag;"></div>
    <div id="exit" class="button-top button-exit">✕</div>
  </div>
  
  <div class="hc" style="width: 100%; height: calc(100% - 20px); position: relative;">
    <div id="wall" style="width: 100%; height: 100%; position: absolute; display: none; z-index: 99999;"></div>

    <div id="removeWindow" class="vc" style="flex-grow: 1; height: 100%; display: none;">
      <div id="removeWindowTitle" style="height: 20px; margin: 20px; color: var(--textPrimary); font-size: 17px;">Title</div>
      <div class="hc" style="width: 100%; position: absolute; bottom: 20px;align-items: center; justify-content: center;">
        <div id="removeWindowRemove" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px; margin-right: 10px;">Remove</div>
        <div id="removeWindowCancel" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px;">Cancel</div>
      </div>
    </div>
    
    <div id="windowBackground" class="vc" style="flex-grow: 1; height: 100%; overflow-y: auto;">
      <div id="window" class="vc" style="flex-grow: 1; height: 100%; overflow-anchor: none;"></div>
    </div>
  </div>
</body>

<script>
  const { app, ipcRenderer, shell } = require('electron')
  window.$ = window.jQuery = require('jquery')
  const fs = require('fs')

  //DATA
  let win = null
  let data = {} //root, data, zip, modules, modulesHidden (folder paths)
  let json = null
  let specialData = null
  let removePaths = []

  win = require('@electron/remote').getCurrentWindow()

  $("#themeDiv").load('Data\\theme.html', function(){
    win.setOpacity(1)
  })

  ipcRenderer.on('load', (event, file, argData, argSpecialData) => {
    data = argData
    refreshData()
    specialData = argSpecialData

    //LAOD FILE
    $("#window").load(file.replaceAll(' ', '%20'))
  })

  //REMOVE WINDOW
  let windowH = 0
  function showRemoveWindow(argPaths) {
    document.getElementById('window').style.display = 'none'
    document.getElementById('removeWindow').style.display = 'flex'

    let size = win.getSize()
    windowH = size[1]
    win.setResizable(true)
    win.setSize(390, 150)
    win.setResizable(false)
    win.center()

    removePaths = argPaths
    if (removePaths.length == 1) {
      let path = removePaths[0]
      if (path.endsWith('.txt')) path = path.slice(0,-4)
      document.getElementById('removeWindowTitle').innerText = 'Remove "' + path.substring(path.lastIndexOf('\\')+1) + '"?'
    } else {
      document.getElementById('removeWindowTitle').innerText = 'Remove ' + removePaths.length + ' Games/Folders?'
    }
  }

  addButtonListener('removeWindowRemove', function() {
    for (i in removePaths) {
      let path = removePaths[i]
      if (fs.existsSync(path)) {
        if (fs.statSync(path).isFile()) {
          fs.unlink(path, (err) => {
            if (i == removePaths.length-1) {
              closeWindow(json.actualPath)
            }
          })
        } else {
          const rimraf = require("rimraf")
          rimraf(path, (err) => {
            if (i == removePaths.length-1) {
              closeWindow(json.actualPath)
            }
          })
        }
      } else if (i == removePaths.length-1) {
        closeWindow()
      }
    }
  })

  addButtonListener('removeWindowCancel', function() {
    document.getElementById('window').style.display = 'flex'
    document.getElementById('removeWindow').style.display = 'none'
    win.setResizable(true)
    win.setSize(390, windowH)
    win.setResizable(false)
    win.center()
  })

  //DATA FUNCTIONS
  function refreshData() {
    let jsonPath = data.data+'settings.json'
    json = JSON.parse(fs.readFileSync(jsonPath))
  }

  function setData(key, value) {
    refreshData()
    json[key] = value
    fs.writeFileSync(data.data+'settings.json', JSON.stringify(json));
  }

  //OTHER
  function closeWindow(specialData) {
    if (specialData != undefined) ipcRenderer.send('specialData', specialData)
    win.close()
  }

  addButtonListener('exit', function() {
    closeWindow()
  })

  //BUTTON LISTENERS
  function addButtonListener(id, click) {
    $('#'+id).bind('click', function() {
      if (event.which != 1) return
      click()
    })
  }

  function addCustomButtonListener(id, mousedown, mouseup, click) {
    $('#'+id).bind('mousedown', function() {
      if (event.which != 1) return
      mousedown()
    })

    $(window).bind('mouseup', function() {
      if (event.which != 1) return
      mouseup()
    })

    $('#'+id).bind('click', function() {
      if (event.which != 1) return
      click()
    })
  }

  function addRightButtonListener(id, click) {
    $('#'+id).bind('contextmenu', function() {
      if (event.which != 3) return
      click()
    })
  }
  
  function addCheckboxListener(id, checked, unchecked) {
    $('#'+id).bind('change', function() {
      if (this.checked)
        checked()
      else 
        unchecked()
    })
  }
</script>
</html>