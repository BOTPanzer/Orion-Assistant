<script>
  //SERVER
  let connectSocket = null
  let connectLog = ''
  
  //START FTP
  refreshData()
  if (json.startServer) connectStartFTP()
  
  function connectStartFTP() {
    const Net = require('net')
    server = new Net.Server()

    server.on('error', function (e) {
      console.log(e)
      server.close()
    })

    server.listen(4444, function() {
      var socket = Net.createConnection(80, 'www.google.com')
      socket.on('connect', function() {
        connectAppend(`Server Started on ${socket.address().address} (Port: 4444)\r\n`)
        socket.end()
      })
      socket.on('error', function(e) {
        connectAppend(`Server Started on localhost (Port: 4444)\r\n`)
      })
    })

    server.on('connection', function(socket) {
      connectSocket = socket
      connectSocket.write('Connection Established\r\n')
      connectAppend('Connection Established\r\n')
      if (currentModule != data.modules+'Connect\\')
        createNoti('Connect:', 'Connection Established')
    
      connectSocket.on('data', function(chunk) {
        connectAppend('Received: '+chunk.toString())
        if (currentModule != data.modules+'Connect\\')
          createNoti('Connect:', 'Received: '+chunk.toString())
      })

      connectSocket.on('end', function() {
        connectAppend('Connection Closed\r\n')
        if (currentModule != data.modules+'Connect\\')
          createNoti('Connect:', 'Connection Closed')
      })

      connectSocket.on('error', function(err) {
        connectAppend(`Error: ${err}\r\n`)
        if (currentModule != data.modules+'Connect\\')
          createNoti('Connect:', 'Error: '+err)
      })
    })
  }

  function connectAppend(text) {
    connectLog = connectLog+text
    if (document.getElementById('connectLog') != null) {
      document.getElementById('connectLog').innerText = connectLog
      document.getElementById('connectLog').scrollTop = document.getElementById('connectLog').scrollHeight
      
      var documentHeight = document.getElementById('window').offsetHeight
      document.getElementById('window').scrollTo(0, documentHeight)
    }
  }
</script>