<script>
  // /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$  /$$$$$$  /$$$$$$$  /$$       /$$$$$$$$  /$$$$$$ 
  //| $$   | $$ /$$__  $$| $$__  $$|_  $$_/ /$$__  $$| $$__  $$| $$      | $$_____/ /$$__  $$
  //| $$   | $$| $$  \ $$| $$  \ $$  | $$  | $$  \ $$| $$  \ $$| $$      | $$      | $$  \__/
  //|  $$ / $$/| $$$$$$$$| $$$$$$$/  | $$  | $$$$$$$$| $$$$$$$ | $$      | $$$$$   |  $$$$$$ 
  // \  $$ $$/ | $$__  $$| $$__  $$  | $$  | $$__  $$| $$__  $$| $$      | $$__/    \____  $$
  //  \  $$$/  | $$  | $$| $$  \ $$  | $$  | $$  | $$| $$  \ $$| $$      | $$       /$$  \ $$
  //   \  $/   | $$  | $$| $$  | $$ /$$$$$$| $$  | $$| $$$$$$$/| $$$$$$$$| $$$$$$$$|  $$$$$$/
  //    \_/    |__/  |__/|__/  |__/|______/|__/  |__/|_______/ |________/|________/ \______/

  let connectSocket = null
  let connectLog = ''
  
  
  //  /$$$$$$   /$$$$$$  /$$$$$$$  /$$$$$$$$
  // /$$__  $$ /$$__  $$| $$__  $$| $$_____/
  //| $$  \__/| $$  \ $$| $$  \ $$| $$      
  //| $$      | $$  | $$| $$  | $$| $$$$$   
  //| $$      | $$  | $$| $$  | $$| $$__/   
  //| $$    $$| $$  | $$| $$  | $$| $$      
  //|  $$$$$$/|  $$$$$$/| $$$$$$$/| $$$$$$$$
  // \______/  \______/ |_______/ |________/

  //START FTP
  if (getData('startServer')) connectStartFTP()
  

  // /$$$$$$$$ /$$   /$$ /$$   /$$  /$$$$$$  /$$$$$$$$ /$$$$$$  /$$$$$$  /$$   /$$  /$$$$$$ 
  //| $$_____/| $$  | $$| $$$ | $$ /$$__  $$|__  $$__/|_  $$_/ /$$__  $$| $$$ | $$ /$$__  $$
  //| $$      | $$  | $$| $$$$| $$| $$  \__/   | $$     | $$  | $$  \ $$| $$$$| $$| $$  \__/
  //| $$$$$   | $$  | $$| $$ $$ $$| $$         | $$     | $$  | $$  | $$| $$ $$ $$|  $$$$$$ 
  //| $$__/   | $$  | $$| $$  $$$$| $$         | $$     | $$  | $$  | $$| $$  $$$$ \____  $$
  //| $$      | $$  | $$| $$\  $$$| $$    $$   | $$     | $$  | $$  | $$| $$\  $$$ /$$  \ $$
  //| $$      |  $$$$$$/| $$ \  $$|  $$$$$$/   | $$    /$$$$$$|  $$$$$$/| $$ \  $$|  $$$$$$/
  //|__/       \______/ |__/  \__/ \______/    |__/   |______/ \______/ |__/  \__/ \______/

  function connectStartFTP() {
    const Net = require('net')
    server = new Net.Server()

    server.on('error', function (e) {
      console.log(e)
      server.close()
    })

    server.listen(4444, function() {
      var socket = Net.createConnection(80, 'www.google.com')
      socket.on('connect', function() {
        connectAppend(`Server Started on ${socket.address().address} (Port: 4444)<br>`)
        socket.end()
      })
      socket.on('error', function(e) {
        connectAppend(`Server Started on localhost (Port: 4444)<br>`)
      })
    })

    server.on('connection', function(socket) {
      connectSocket = socket
      connectSocket.write('Connection Established\r\n')
      connectAppend('Connection Established<br>')
      if (currentModule != data.modules+'Connect\\')
        createNoti('Connect', 'Connection Established', () => loadModule(data.modules+'Connect'))
    
      connectSocket.on('data', function(chunk) {
        connectAppend(`<ins>Received:</ins> ${chunk.toString()}<br>`)
        if (currentModule != data.modules+'Connect\\')
          createNoti('Connect', 'Received: '+chunk.toString(), () => loadModule(data.modules+'Connect'))
      })

      connectSocket.on('end', function() {
        connectAppend('Connection Closed<br>')
        if (currentModule != data.modules+'Connect\\')
          createNoti('Connect', 'Connection Closed', () => loadModule(data.modules+'Connect'))
      })

      connectSocket.on('error', function(err) {
        connectAppend(`<ins>Error:</ins> ${err}<br>`)
        if (currentModule != data.modules+'Connect\\')
          createNoti('Connect', 'Error: '+err, () => loadModule(data.modules+'Connect'))
      })
    })
  }

  function connectAppend(text) {
    connectLog = connectLog+text
    if (document.getElementById('connectLog') != null) {
      document.getElementById('connectLog').innerHTML = connectLog
      document.getElementById('connectLog').scrollTop = document.getElementById('connectLog').scrollHeight
      
      var documentHeight = document.getElementById('window').offsetHeight
      document.getElementById('window').scrollTo(0, documentHeight)
    }
  }
</script>