<div id="content" class="win-c">
  <div class="win-t">
    <div id="title" class="title">Home</div>
    <o-rbutton id="libraryAdd" ball>
      <svg viewBox="0 0 24 24">
        <path d="M18 12.75H6C5.59 12.75 5.25 12.41 5.25 12C5.25 11.59 5.59 11.25 6 11.25H18C18.41 11.25 18.75 11.59 18.75 12C18.75 12.41 18.41 12.75 18 12.75Z"/>
        <path d="M12 18.75C11.59 18.75 11.25 18.41 11.25 18V6C11.25 5.59 11.59 5.25 12 5.25C12.41 5.25 12.75 5.59 12.75 6V18C12.75 18.41 12.41 18.75 12 18.75Z"/>
      </svg>
    </o-rbutton>
    
    <div style="flex-grow: 1; margin-right: -20px;"></div>
    
    <o-rbutton style="padding-left: 10px;" onclick="document.getElementById('librarySearchInput').input.focus()">
      <svg id="librarySearch" viewBox="0 0 488 488" style="width: 18px; height: 18px; margin: 10px;">
        <path d="M452.2,425.6L330.8,304.1c23.9-28.7,38.3-65.4,38.3-105.4c0-91.4-75-165.7-167.3-165.7S34.4,107.4,34.4,198.8s75,165.7,167.3,165.7c39.2,0,75.3-13.4,103.9-35.9l121.8,121.8c7.1,7.1,17.7,7.1,24.8,0C459.3,443.3,459.3,432.7,452.2,425.6zM70,198.8C70,127,129.1,68.6,201.7,68.6S333.4,127,333.4,198.8s-59.1,130.2-131.7,130.2S70,270.5,70,198.8z"/>
      </svg>
      <o-input id="librarySearchInput" style="width: 140px; margin-left: 5px;" placeholder="Search" label="Search" transparent></o-input>
    </o-rbutton>
  </div>

  <div id="libraryEmpty" class="vc" style="width: 100%; align-items: center; display: none;">
    <div style="font-size: 100px; margin-top: 20px;">üòû</div>
    <div style="font-size: 15px; color: var(--text1);">Such empty...</div>
    <div style="font-size: 15px; color: var(--text2);">Try importing from the (+) button</div>
  </div>

  <div id="libraryList" style="display: grid; gap: 15px; grid-template-columns: repeat(auto-fill, 150px); justify-content: center;"></div>

  <div id="moveWindow" style="padding: 20px; position: fixed; right: 30px; bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 20px; background: var(--background); border-radius: 20px; box-shadow: var(--shadow2); opacity: 0; pointer-events: none; transition: opacity .2s;">
    <span id="moveTitle">Move 3 items here?</span>
    <div class="hc" style="gap: 10px;">
      <o-rbutton id="moveMove" small text="Move" style="width: 130px;"></o-rbutton>
      <o-rbutton id="moveCancel" small text="Cancel" style="width: 130px;"></o-rbutton>
    </div>
  </div>
</div>





<script>
  //MODULE NAME USED IN - TRAY & MAIN.HTML & SETTINGS üò°

  // /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$  /$$$$$$  /$$$$$$$  /$$       /$$$$$$$$  /$$$$$$ 
  //| $$   | $$ /$$__  $$| $$__  $$|_  $$_/ /$$__  $$| $$__  $$| $$      | $$_____/ /$$__  $$
  //| $$   | $$| $$  \ $$| $$  \ $$  | $$  | $$  \ $$| $$  \ $$| $$      | $$      | $$  \__/
  //|  $$ / $$/| $$$$$$$$| $$$$$$$/  | $$  | $$$$$$$$| $$$$$$$ | $$      | $$$$$   |  $$$$$$ 
  // \  $$ $$/ | $$__  $$| $$__  $$  | $$  | $$__  $$| $$__  $$| $$      | $$__/    \____  $$
  //  \  $$$/  | $$  | $$| $$  \ $$  | $$  | $$  | $$| $$  \ $$| $$      | $$       /$$  \ $$
  //   \  $/   | $$  | $$| $$  | $$ /$$$$$$| $$  | $$| $$$$$$$/| $$$$$$$$| $$$$$$$$|  $$$$$$/
  //    \_/    |__/  |__/|__/  |__/|______/|__/  |__/|_______/ |________/|________/ \______/

  libraryFile = cModule.path+'library.xml'
  libraryPath = []
  libraryXML = {}
  librarySearch = ''
  librarySelecting = false
  librarySelected  = []
  library = getKey('library')
  

  //  /$$$$$$   /$$$$$$  /$$$$$$$  /$$$$$$$$
  // /$$__  $$ /$$__  $$| $$__  $$| $$_____/
  //| $$  \__/| $$  \ $$| $$  \ $$| $$      
  //| $$      | $$  | $$| $$  | $$| $$$$$   
  //| $$      | $$  | $$| $$  | $$| $$__/   
  //| $$    $$| $$  | $$| $$  | $$| $$      
  //|  $$$$$$/|  $$$$$$/| $$$$$$$/| $$$$$$$$
  // \______/  \______/ |_______/ |________/

  //SHOW SCROLLBAR
  document.getElementById('window').style.overflowY = 'scroll'

  //SETTINGS KEY
  if (library == undefined) {
    library = { path: [] }
    setKey('library', library)
  }

  //LIBRARY PATH
  if (!Array.isArray(library.path)) {
    library.path = []
    setKey('library', library)
  }

  //LIBRARY XML
  if (!fs.existsSync(libraryFile)) {
    libraryXML = document.createElement('library')
    saveXML()
  }
  libraryXML = new DOMParser().parseFromString(fs.readFileSync(libraryFile), 'text/xml').getElementsByTagName('library')[0]

  //CREATE LIST
  createList(library.path, '')


  // /$$       /$$$$$$  /$$$$$$  /$$$$$$$$ /$$$$$$$$ /$$   /$$ /$$$$$$$$ /$$$$$$$   /$$$$$$ 
  //| $$      |_  $$_/ /$$__  $$|__  $$__/| $$_____/| $$$ | $$| $$_____/| $$__  $$ /$$__  $$
  //| $$        | $$  | $$  \__/   | $$   | $$      | $$$$| $$| $$      | $$  \ $$| $$  \__/
  //| $$        | $$  |  $$$$$$    | $$   | $$$$$   | $$ $$ $$| $$$$$   | $$$$$$$/|  $$$$$$ 
  //| $$        | $$   \____  $$   | $$   | $$__/   | $$  $$$$| $$__/   | $$__  $$ \____  $$
  //| $$        | $$   /$$  \ $$   | $$   | $$      | $$\  $$$| $$      | $$  \ $$ /$$  \ $$
  //| $$$$$$$$ /$$$$$$|  $$$$$$/   | $$   | $$$$$$$$| $$ \  $$| $$$$$$$$| $$  | $$|  $$$$$$/
  //|________/|______/ \______/    |__/   |________/|__/  \__/|________/|__/  |__/ \______/

  ipcRenderer.on('specialData', (event, specialData) => {
    if (specialData == undefined) return
    document.getElementById('content').style.minHeight = document.getElementById('content').offsetHeight+'px'
    createList(specialData)
  })

  ipcRenderer.on('requestedIcon', (event, icon, tag) => {
    if (document.getElementById(tag) != null)
      document.getElementById(tag).src = icon
  })

  //ADD
  clickListener('libraryAdd', function() {
    let dialogid = createDialog(fs.readFileSync(cModule.path+'add.html').toString(), 'Add games/folders')

    //DIALOG LISTENERS
    clickListener('folder', function() {
      setDialogTitle(dialogid, 'Add Folder')
      document.getElementById('addWindow').style.display = 'none'
      document.getElementById('folderWindow').style.display = 'flex'

      //FOLDER LISTENERS
      $('#folderName').on('keydown', function(event) {
        if (event.keyCode === 13) {
          event.preventDefault()
          document.getElementById('folderAdd').click()
          return false
        }
      })
      
      clickListener('folderIconFolder', function() {
        event.stopPropagation()
        let gamePathArg = getPathInfo(document.getElementById('folderIcon').value)
        let path = gamePathArg.pathClean.substring(0, gamePathArg.pathClean.lastIndexOf('\\')+1)
        ipcRenderer.send('getFile', 'requestedFolderIcon', 'Choose an Icon', path)
      })

      ipcRenderer.removeAllListeners('requestedFolderIcon')
      ipcRenderer.on('requestedFolderIcon', (event, path) => {
        if (path == '') return
        ipcRenderer.send('getBase64', 'requestedFolderBase64', path, path)
      })

      ipcRenderer.removeAllListeners('requestedFolderBase64')
      ipcRenderer.on('requestedFolderBase64', async (event, base64, tag) => {
        if (base64 == '') 
          document.getElementById('folderIcon').value = tag
        else {
          const result = await resizeBase64Image(base64)
          document.getElementById('folderIcon').value = result
        }
        refreshIcon()
      })

      clickListener('folderImg', refreshIcon)

      function refreshIcon() {
        let icon = document.getElementById('folderIcon').value.trim()
        ipcRenderer.send('getIcon', 'requestedFolderIcon2', icon, 'folder')
      }
    
      ipcRenderer.removeAllListeners('requestedFolderIcon2')
      ipcRenderer.on('requestedFolderIcon2', (event, icon, tag) => {
        document.getElementById('folderImg').src = icon
      })
      
      clickListener('folderAdd', function() {
        let name = document.getElementById('folderName').value.trim()
        let icon = document.getElementById('folderIcon').value.trim()
        if (name == '') {
          createNoti('Library', 'Name is necesary')
          return
        }
        //DESTINATION FOLDER
        let dest = getItem(libraryPath)
        if (dest == undefined) {
          createNoti('Library', 'Error finding destination folder')
          return
        }
        if (dest.tagName != 'library' && dest.tagName != 'folder') {
          createNoti('Library', 'Destination is not a folder')
          return
        }
        //CHECK IF FOLDER EXISTS
        if (existsFolderFrom(name, dest)) {
          createNoti('Library', `'${name}' already exists`)
          return
        }
        //ADD FOLDER
        dest.insertAdjacentHTML('beforeend', `<folder name="${formatText(name)}" icon="${formatText(icon)}"/>`)
        //SAVE FILE & CLOSE DIALOG & REFRESH LIST
        saveXML()
        closeDialog(dialogid)
        createList('refresh')
      })
    })
  
    clickListener('game', function() {
      setDialogTitle(dialogid, 'Add Game')
      document.getElementById('addWindow').style.display = 'none'
      document.getElementById('gameWindow').style.display = 'flex'

      //GAME LISTENERS
      clickListener('gamePathFolder', function() {
        event.stopPropagation()
        let a = document.getElementById('gamePath').value
        let gamePathArg = getPathInfo(a)
        let path = gamePathArg.pathClean.substring(0, gamePathArg.pathClean.lastIndexOf('\\')+1)
        ipcRenderer.send('getFile', 'requestedGame', 'Choose a Game', path)
      })
    
      ipcRenderer.removeAllListeners('requestedGame')
      ipcRenderer.on('requestedGame', (event, path) => {
        if (path == '') return
        document.getElementById('gamePath').value = path
        if (document.getElementById('gameName').value == '') {
          let name = path.substring(path.lastIndexOf('\\')+1)
          if (name.includes('.')) name = name.substring(0, name.lastIndexOf('.'))
          document.getElementById('gameName').value = name
        }
        refreshIcon()
      })
      
      clickListener('gameIconFolder', function() {
        event.stopPropagation()
        let a = document.getElementById('gamePath').value
        if (document.getElementById('gameIcon').value != '') a = document.getElementById('gameIcon').value
        let gamePathArg = getPathInfo(a)
        let path = gamePathArg.pathClean.substring(0, gamePathArg.pathClean.lastIndexOf('\\')+1)
        ipcRenderer.send('getFile', 'requestedGameIcon', 'Choose an Icon', path)
      })

      ipcRenderer.removeAllListeners('requestedGameIcon')
      ipcRenderer.on('requestedGameIcon', (event, path) => {
        if (path == '') return
        ipcRenderer.send('getBase64', 'requestedGameBase64', path, path)
      })

      ipcRenderer.removeAllListeners('requestedGameBase64')
      ipcRenderer.on('requestedGameBase64', async (event, base64, tag) => {
        if (base64 == '') 
          document.getElementById('gameIcon').value = tag
        else {
          const result = await resizeBase64Image(base64)
          document.getElementById('gameIcon').value = result
        }
        refreshIcon()
      })

      clickListener('gameImg', refreshIcon)

      function refreshIcon() {
        let icon = document.getElementById('gameIcon').value.trim()
        let path = document.getElementById('gamePath').value.trim()
        if (icon != '')
          ipcRenderer.send('getIcon', 'requestedGameIcon2', icon, 'game')
        else 
          ipcRenderer.send('getIcon', 'requestedGameIcon2', path, 'game')
      }
    
      ipcRenderer.removeAllListeners('requestedGameIcon2')
      ipcRenderer.on('requestedGameIcon2', (event, icon, tag) => {
        document.getElementById('gameImg').src = icon
      })
      
      clickListener('gameAdd', function() {
        let name = document.getElementById('gameName').value.trim()
        if (name == '') {
          createNoti('Library', 'Name is necesary')
          return
        }
        let path = document.getElementById('gamePath').value.trim()
        if (path == '') {
          createNoti('Library', 'Path is necesary')
          return
        }
        let icon = document.getElementById('gameIcon').value.trim()
        //DESTINATION FOLDER
        let dest = getItem(libraryPath)
        if (dest == undefined) {
          createNoti('Library', 'Error finding destination folder')
          return
        }
        if (dest.tagName != 'library' && dest.tagName != 'folder') {
          createNoti('Library', 'Destination is not a folder')
          return
        }
        //CHECK IF GAME EXISTS
        if (existsGameFrom(name, dest)) {
          createNoti('Library', `'${name}' already exists`)
          return
        }
        //ADD FOLDER
        dest.insertAdjacentHTML('beforeend', `<game name="${formatText(name)}" path="${formatText(path)}" icon="${formatText(icon)}"/>`)
        //SAVE FILE & CLOSE DIALOG & REFRESH LIST
        saveXML()
        closeDialog(dialogid)
        createList('refresh')
      })
    })

    clickListener('import', function() {
      ipcRenderer.send('getFolder', 'requestedImportFolder', 'Folder to import shortcuts from')
      
      //IMPORT LISTENERS
      ipcRenderer.removeAllListeners('requestedImportFolder')
      ipcRenderer.on('requestedImportFolder', (event, folderPath) => {
        if (folderPath == '') return
        ipcRenderer.send('pause')
        //GET SHORTCUTS
        let files = readdirSync(folderPath)
        let shortcuts = []
        for(i in files) {
          let f = files[i].toLowerCase()
          if (f.endsWith('.lnk') || f.endsWith('.url') || f.endsWith('.json')) {
            shortcuts.push(files[i])
          }
        }
        if (shortcuts.length == 0) {
          createNoti('Library', 'Nothing to import')
          return
        }
        //CREATE LIST
        for(i in shortcuts) {
          let id = 'short'+i
          let short = shortcuts[i]
          let name = short.substring(short.lastIndexOf('\\')+1)
          if (name.includes('.')) name = name.substring(0, name.lastIndexOf('.'))
          document.getElementById('importList').insertAdjacentHTML('beforeend', `<o-rbutton id="${id}" small style="width: 100%;">${name}</o-rbutton>`)
          clickListener(id, function() {
            let index = shortcuts.indexOf(short)
            if (index == -1) return
            shortcuts.splice(index, 1)
            document.getElementById(id).remove()
            if (shortcuts.length == 0) closeDialog(dialogid)
          })
        }
        //SHOW IMPORT WINDOW
        setDialogTitle(dialogid, 'Import')
        document.getElementById('addWindow').style.display = 'none'
        document.getElementById('importWindow').style.display = 'flex'
        ipcRenderer.send('resume')
        //ADD IMPORT LISTENER
        clickListener('importImport', function() {
          //DESTINATION FOLDER
          let dest = getItem(libraryPath)
          if (dest == undefined) {
            createNoti('Library', 'Error finding destination folder')
            return
          }
          if (dest.tagName != 'library' && dest.tagName != 'folder') {
            createNoti('Library', 'Destination is not a folder')
            console.log(dest.tagName)
            return
          }
          //START
          ipcRenderer.send('pause')
          setDialogTitle(dialogid, 'Importing...')
          //IMPORT SHORTCUTS
          for(i in shortcuts) {
            let shortcut = shortcuts[i]
            let name = shortcut.substring(folderPath.length+1)
            name = name.substring(0, name.lastIndexOf('.'))
            //CHECK IF GAME & FOLDERS EXIST
            let destNew = Array.from(libraryPath)
            let destFinal = dest
            let pathTmp = name.split('\\')
            let existsError = false
            for (i2 in pathTmp) {
              let nam = pathTmp[i2]
              if (i2 != pathTmp.length-1) {
                //FOLDER EXISTS?
                if (!existsFolderFrom(nam, destFinal)) {
                  //CREATE FOLDER
                  destFinal.insertAdjacentHTML('beforeend', `<folder name="${formatText(nam)}"/>`)
                }
                destNew.push(nam)
                destFinal = getItem(destNew)
                if (destFinal == undefined) {
                  existsError = true
                  break
                }
              } else {
                if (existsGameFrom(nam, destFinal)) {
                  //GAME EXISTS
                  existsError = true
                  break
                }
                name = nam
              }
            }
            if (existsError) {
              itemErrors++
              continue
            }
            //GET DATA
            let path = ''
            let icon = ''
            let admin = ''
            switch (shortcut.toLowerCase().substring(shortcut.lastIndexOf('.'))) {
              case '.lnk':
                //WINDOWS SHORTCUT (LNK)
                try {
                  let short = shell.readShortcutLink(shortcut)
                  path = short.target
                  if (short.args != '') path = `"${path}" ${short.args}`
                  icon = short.icon
                  if (path == icon) icon = ''
                } catch(e) {}
                break
              case '.url':
                //URL SHORTCUT (URL)
                let shdata = fs.readFileSync(shortcut).toString().split('\r\n')
                for (i2 in shdata) {
                  let str = shdata[i2]
                  if (str.startsWith('URL=')) path = str.substring(4)
                  if (str.startsWith('IconFile=')) icon = str.substring(9)
                }
                break
              case '.json':
                //ASSISTANT JSON LIBRARY GAME (JSON)
                try {
                  let sisData = JSON.parse(fs.readFileSync(shortcut))
                  if (sisData.path != undefined) path = sisData.path
                  if (sisData.icon != undefined) icon = sisData.icon
                  if (sisData.admin != undefined) admin = sisData.admin
                } catch(e) {}
                break
            }
            //CHECK DATA
            if (typeof path != 'string' || path == '') {
              itemErrors++
              continue
            }
            if (typeof icon != 'string') icon = ''
            //ADD GAME
            destFinal.insertAdjacentHTML('beforeend', `<game name="${formatText(name)}" path="${formatText(path)}" icon="${formatText(icon)}" admin="${formatText(admin)}"/>`)
          }
          //ERRORS
          if (itemErrors > 0) createNoti('Library', `Errors: ${itemErrors}`)
          //SAVE FILE & CLOSE DIALOG & REFRESH LIST
          saveXML()
          ipcRenderer.send('resume')
          closeDialog(dialogid)
          createList('refresh')
        })
      })
    
      //RECURSIVE READDIR
      const fs = require('fs')
      const path = require('path')

      const readdirSync = (p, a = []) => {
        if (fs.statSync(p).isDirectory())
          fs.readdirSync(p).map(f => readdirSync(a[a.push(path.join(p, f)) - 1], a))
        return a
      }


    })
  })

  //SEARCH
  clickListener('librarySearch', function() {
    event.stopPropagation()
    let search = document.getElementById('librarySearchInput').value
    if (search == '') return
    createList('refresh', search)
  })

  keydownListener('librarySearchInput', function() {
    if (event.which != 13) return
    event.preventDefault()
    let search = document.getElementById('librarySearchInput').value
    if (search == '') return
    createList('refresh', search)
  })


  // /$$$$$$$$ /$$   /$$ /$$   /$$  /$$$$$$  /$$$$$$$$ /$$$$$$  /$$$$$$  /$$   /$$  /$$$$$$ 
  //| $$_____/| $$  | $$| $$$ | $$ /$$__  $$|__  $$__/|_  $$_/ /$$__  $$| $$$ | $$ /$$__  $$
  //| $$      | $$  | $$| $$$$| $$| $$  \__/   | $$     | $$  | $$  \ $$| $$$$| $$| $$  \__/
  //| $$$$$   | $$  | $$| $$ $$ $$| $$         | $$     | $$  | $$  | $$| $$ $$ $$|  $$$$$$ 
  //| $$__/   | $$  | $$| $$  $$$$| $$         | $$     | $$  | $$  | $$| $$  $$$$ \____  $$
  //| $$      | $$  | $$| $$\  $$$| $$    $$   | $$     | $$  | $$  | $$| $$\  $$$ /$$  \ $$
  //| $$      |  $$$$$$/| $$ \  $$|  $$$$$$/   | $$    /$$$$$$|  $$$$$$/| $$ \  $$|  $$$$$$/
  //|__/       \______/ |__/  \__/ \______/    |__/   |______/ \______/ |__/  \__/ \______/
  
  function createList(argPath, search) {
    if (typeof argPath === 'string') argPath = argPath.split('/')
    if (typeof search !== 'string') search = ''
    search = search.toLowerCase()
    //GET FOLDER & PATH
    if (argPath == 'refresh') argPath = library.path
    if (!Array.isArray(argPath)) argPath = []
    let folder = libraryXML
    let path = []
    //GET FOLDER ARRAY
    for (i in argPath) {
      let goodKey = false
      let folderTmp = folder
      let folderName = argPath[i]
      let folderElems = folderTmp.childNodes
      //CHECK IF KEY IS A FOLDER
      for (i2 in folderElems) {
        let elem = folderElems[i2]
        if (elem.tagName == 'folder' && getA(elem, 'name') == folderName) {
          goodKey = true
          folderTmp = elem
          break
        }
      }
      //IF KEY IS NOT A FOLDER STAY WHERE WE ARE
      if (!goodKey) break
      //UPDATE PATH
      folder = folderTmp
      path.push(folderName)
    }
    //SAVE PATH
    libraryPath = Array.from(path)
    library.path = Array.from(path)
    setKey('library', library)
    //SET TITLE
    let title = 'Home'
    if (path.length > 0) title = path[path.length-1]
    if (search != '') title = title+' - '+search
    document.getElementById('title').innerText = title
    //PREPARE LIBRARY
    librarySelecting = false
    librarySelected = []
    librarySearch = search
    document.getElementById('libraryEmpty').style.display = 'none'
    $('#libraryList *').off()
    document.getElementById('libraryList').innerHTML = ''
    //CREATE BACK BUTTON
    if (path.length != 0 || search != '') {
      let backPath = Array.from(path)
      if (backPath.length != 0 && search == '') backPath.pop()
      //HTML
      let data = {
        id: 'backB',
        name: 'Back',
        img: './Data/Images/back.png',
        type: 'folder',
        path: backPath
      }
      document.getElementById('libraryList').insertAdjacentHTML('beforeend', createDataHTML(data))
      addListener(data)
    }
    //SORT ALPHABETICALLY
    let items = sortItems(folder, search)
    addGames(items.folders, items.games, search)
  }

  function sortItems(folder, search) {
    if (typeof folder !== 'object') return { folders: [], games: [] }
    if (typeof search !== 'string') search = ''
    //DATA
    let folders = []
    let games = []
    let items
    if (search != '')
      items = folder.getElementsByTagName("*")
    else 
      items = folder.childNodes
    //SEPARATE & FIlTER FOLDERS & GAMES
    for (i in items) {
      switch (items[i].tagName) {
        case 'folder':
          //ADD FOLDER
          if (search == '')
            folders.push(items[i])
          break
        case 'game':
          //ADD GAME
          if (search == '')
            games.push(items[i])
          //ADD GAME & LOCATION
          else if (items[i].getAttribute('name').toLowerCase().includes(search)) {
            let loc = ''
            let goodLock = false
            let game = items[i]
            if (game.parentNode.tagName == 'library') goodLock = true
            while (game.parentNode.tagName != 'library') {
              game = game.parentNode
              let name = game.getAttribute('name')
              if (name != '') {
                if (loc != '')
                  loc = `${name}/${loc}`
                else
                  loc = name
                goodLock = true
              }
              else {
                loc = ''
                goodLock = true
              }
            }
            if (goodLock) {
              items[i].setAttribute('location', loc)
              games.push(items[i])
            }
          }
          break
      }
    }
    //SORT
    games.sort(function(a, b){
      if(a.getAttribute('name') < b.getAttribute('name')) { return -1 }
      if(a.getAttribute('name') > b.getAttribute('name')) { return 1 }
      return 0
    })
    games.sort(function(a, b){
      if(a.getAttribute('name') < b.getAttribute('name')) { return -1 }
      if(a.getAttribute('name') > b.getAttribute('name')) { return 1 }
      return 0
    })
    //RETURN
    return { folders, games }
  }

  async function addGames(folders, games, search) {
    let itemsCreated = 0
    let itemNames = []
    //FOLDERS
    for (i in folders) {
      let folder = folders[i]
      //CHECK FOR ATTRIBUTES
      let atts = folder.getAttributeNames()
      if (atts.indexOf('name') == -1) continue
      //GET ATTRIBUTES
      let data = {}
      for (i2 in atts) { data[atts[i2]] = folder.getAttribute(atts[i2]) }
      //CHECK VALUES & DONT REPEAT NAME
      if (itemNames.indexOf(data.name) != -1) continue
      if (data.name == '') continue
      itemNames.push(data.name)
      if (typeof data.icon != 'string') data.icon = ''
      //ADD ATTRIBUTES
      data.id = `folder${i}-${Date.now()}`
      data.img = './Data/Images/folder.png'
      data.type = 'folder'
      data.path = Array.from(libraryPath)
      data.path.push(data.name)
      data.location = libraryPath.join('/')
      //ADD HTML
      document.getElementById('libraryList').insertAdjacentHTML('beforeend', createDataHTML(data))
      //ADD LISTENER
      addListener(data)
      //CHANGE IMAGE
      if (typeof data.icon == 'string' && data.icon != '')
        ipcRenderer.send('getIcon', 'requestedIcon', data.icon, 'img-'+data.id)
      //FOLDER CREATED
      itemsCreated++
    }
    //GAMES
    for (i in games) {
      let game = games[i]
      //CHECK FOR ATTRIBUTES
      let atts = game.getAttributeNames()
      if (atts.indexOf('name') == -1) continue
      if (atts.indexOf('path') == -1) continue
      //GET ATTRIBUTES
      let data = {}
      for (i2 in atts) { data[atts[i2]] = game.getAttribute(atts[i2]) }
      //CHECK VALUES & DONT REPEAT NAME
      if (itemNames.indexOf(data.name) != -1) continue
      if (data.name == '') continue
      itemNames.push(data.name)
      if (data.path == '') continue
      if (typeof data.icon != 'string') data.icon = ''
      //ADD ATTRIBUTES
      data.id = `game${i}-${Date.now()}`
      data.img = './Data/Images/file.png'
      data.type = 'game'
      if (!data.location) data.location = libraryPath.join('/')
      let pInfo = getPathInfo(data.path)
      data.pathClean = pInfo.pathClean
      data.pathArgs = pInfo.pathArgs
      //ADD HTML
      document.getElementById('libraryList').insertAdjacentHTML('beforeend', createDataHTML(data))
      //ADD LISTENER
      addListener(data)
      //CHANGE IMAGE
      if (data.icon != '')
        ipcRenderer.send('getIcon', 'requestedIcon', data.icon, 'img-'+data.id)
      else if (data.pathClean != '')
        ipcRenderer.send('getIcon', 'requestedIcon', data.pathClean, 'img-'+data.id)
      //GAME CREATED
      itemsCreated++
    }
    //FINISH
    document.getElementById('content').style.minHeight = ''
    if (libraryPath.join('') == '' && search == '' && itemsCreated == 0) document.getElementById('libraryEmpty').style.display = 'flex'
  }

  function createDataHTML(data) {
    return `<o-button id="${data.id}" content="box" style="width: 150px; height: 200px; --oBorderR: 35px; flex-direction: column;">
              <img id="img-${data.id}" style="width: 120px; height: 120px; margin: 15px; border-radius: 20px; object-fit: contain;" src="${data.img}" onerror="if(!this.src.endsWith('${data.img}')) this.src='${data.img}'">
              <div style="width: 120px; height: 40px; margin: 15px; margin-top: 0; display: flex; align-items: center; justify-content: center;">
                <span id="name-${data.id}" style="font-size: 15px; line-height: 20px; text-align: center; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">${data.name}</span>
              </div>
              <svg id="selected-${data.id}" style="height: 24px; width: 24px; visibility: hidden; position: absolute; top: 15px; right: 15px; filter: drop-shadow(var(--shadow));" viewBox="0 0 24 24">
                <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM16.78 9.7L11.11 15.37C10.97 15.51 10.78 15.59 10.58 15.59C10.38 15.59 10.19 15.51 10.05 15.37L7.22 12.54C6.93 12.25 6.93 11.77 7.22 11.48C7.51 11.19 7.99 11.19 8.28 11.48L10.58 13.78L15.72 8.64C16.01 8.35 16.49 8.35 16.78 8.64C17.07 8.93 17.07 9.4 16.78 9.7Z"/>
              </svg>
              <div style="display: none;">
                <div id="type-${data.id}">${data.type}</div>
                <div id="icon-${data.id}">${data.icon}</div>
                <div id="location-${data.id}">${data.location}</div>
              </div>
            </o-button>`
  }

  function addListener(data) {
    //DATA
    let id = data.id
    let img = 'img-'+id
    let name = data.name
    let path = data.path
    let location = data.location
    let filePath = name
    if (location != '') filePath = location+'/'+name
    let isFolder = (data.type == 'folder')

    //LISTENERS
    if (id != 'backB') 
    longpressListener(id, function() {
      if (!librarySelecting) librarySelecting = true
    }, 300)

    clickListener(id, function() {
      if (librarySelecting && id != 'backB') {
        if (librarySelected.includes(id)) {
          //ALREADY SELECTED
          librarySelected.splice(librarySelected.indexOf(id), 1)
          document.getElementById('selected-'+id).style.visibility = 'hidden'
          if (librarySelected.length == 0) librarySelecting = false
        } else {
          //ADD TO SELECTED
          librarySelected.push(id)
          document.getElementById('selected-'+id).style.visibility = 'visible'
        }
      } else if (isFolder) {
        //FOLDER
        openFolder(path)
        if (id == 'backB') 
          document.getElementById('librarySearchInput').value = ''
      }
    })

    if (!isFolder)
    duobleClickListener(id, function() {
      if (!librarySelecting) {
        //OPEN AS ADMIN
        let admin = (data.admin == 'true')
        //PATH & ARGS
        let pathClean = data.pathClean
        let pathArgs = data.pathArgs
        openFile(id, admin, name, pathClean, pathArgs)
      }
    })

    if (id != 'backB')
    contextListener(id, function() {
      if (librarySelected.length > 1 && librarySelected.includes(id)) {
        //SELECTED MULTIPLE
        multiDialog()
      } else if (!librarySelecting || librarySelected.length == 1 && librarySelected.includes(id)) {
        if (isFolder) {
          //SELECTED FOLDER
          folderDialog()
        } else {
          //SELECTED FILE
          fileDialog()
        }
      }

      //DIALOGS
      function multiDialog() {
        let dialogid = createDialog(fs.readFileSync(cModule.path+'multi.html').toString())

        //PREPARE DIALOG
        let paths = []
        for(i in librarySelected) {
          let id = librarySelected[i]
          let type = 'folder'
          if (id.startsWith('game')) type = 'game'
          let name = document.getElementById('name-'+id).innerText
          let location = document.getElementById('location-'+id).innerText
          let filePath = name
          if (location != '') filePath = location+'/'+name
          //ADD FILEPATH
          paths.push(`${type}://${filePath}`)
          //CHANGE NAME
          if (type == 'game')
            name = `üéÆ ${name}`
          else 
            name = `üìÅ ${name}`
          document.getElementById('multiList').insertAdjacentHTML('beforeend', `<o-rbutton small style="width: 100%;">${name}</o-rbutton>`)
        }
        setDialogTitle(dialogid, paths.length+' Items Selected')

        //DIALOG LISTENERS
        clickListener('multiMove', function() {
          moveFiles(paths, dialogid)
        })

        clickListener('multiRemove', function() {
          document.getElementById('removeTitle').innerHTML = `Remove ${paths.length} items?`
          document.getElementById('multiWindow').style.display = 'none'
          document.getElementById('removeWindow').style.display = 'flex'
        })

        clickListener('removeRemove', function() {
          removeFiles(paths, dialogid)
        })

        clickListener('removeCancel', function() {
          document.getElementById('multiWindow').style.display = 'flex'
          document.getElementById('removeWindow').style.display = 'none'
        })
      }
    
      function folderDialog() {
        let dialogid = createDialog(fs.readFileSync(cModule.path+'folder.html').toString(), 'Folder properties')

        //PREPARE DIALOG
        let paths = [`folder://${filePath}`]
        let oldName = data.name
        let oldIcon = data.icon
        document.getElementById('folderName').value = oldName
        document.getElementById('folderIcon').value = oldIcon
        document.getElementById('folderImg').src = document.getElementById(img).src
        refreshIcon()

        //DIALOG LISTENERS
        clickListener('folderIconFolder', function() {
          event.stopPropagation()
          let value = document.getElementById('folderIcon').value
          let pathInfo = getPathInfo(value)
          let path = pathInfo.pathClean.substring(0, pathInfo.pathClean.lastIndexOf('\\')+1)
          ipcRenderer.send('getFile', 'requestedFileIcon', 'Choose an Icon', path)
        })

        ipcRenderer.removeAllListeners('requestedFileIcon')
        ipcRenderer.on('requestedFileIcon', (event, path) => {
          if (path == '') return
          ipcRenderer.send('getBase64', 'requestedFileBase64', path, path)
        })

        ipcRenderer.removeAllListeners('requestedFileBase64')
        ipcRenderer.on('requestedFileBase64', async function(event, base64, tag) {
          if (base64 == '') 
            document.getElementById('folderIcon').value = tag
          else {
            const result = await resizeBase64Image(base64)
            document.getElementById('folderIcon').value = result
          }
          refreshIcon()
        }) 
        
        clickListener('folderMove', function() {
          moveFiles(paths, dialogid)
        })
          
        clickListener('folderRemove', function() {
          document.getElementById('removeTitle').innerHTML = `Remove '${oldName}'?`
          document.getElementById('folderWindow').style.display = 'none'
          document.getElementById('removeWindow').style.display = 'flex'
        })
        
        clickListener('removeRemove', function() {
          removeFiles(paths, dialogid)
        })

        clickListener('removeCancel', function() {
          document.getElementById('folderWindow').style.display = 'flex'
          document.getElementById('removeWindow').style.display = 'none'
        })
        
        clickListener('folderSave', function() {
          let newName = document.getElementById('folderName').value.trim()
          let newIcon = document.getElementById('folderIcon').value.trim()
          if (newName == oldName && newIcon == oldIcon) closeDialog(dialogid)
          else if (newName == '') createNoti('Library', 'Name is necesary')
          else if (newName.includes('/')) createNoti('Library', "Forbidden character '/'")
          else {
            //GET FOLDER
            let item = getItem(filePath)
            if (item == undefined) {
              createNoti('Library', 'Error finding folder')
              return
            }
            //CHECK IF NEW NAME EXISTS
            if (newName != oldName) {
              //GET FOLDER
              let folder = getItem(location)
              if (folder == undefined) {
                createNoti('Library', 'Error finding parent folder')
                return
              }
              //CHECK IF FOLDER EXISTS
              if (existsFolderFrom(newName, folder)) {
                createNoti('Library', `'${newName}' already exists`)
                return
              }
            }
            //UPDATE GAME
            item.setAttribute('name', newName)
            item.setAttribute('icon', newIcon) 
            //SAVE FILE & CLOSE DIALOG & REFRESH LIST
            saveXML()
            closeDialog(dialogid)
            createList('refresh')
          }
        })
      
        //REFRESH ICON
        clickListener('folderImg', refreshIcon)

        function refreshIcon() {
          let icon = document.getElementById('folderIcon').value.trim()          
          ipcRenderer.send('getIcon', 'requestedFileIcon2', icon, filePath)
        }
      
        ipcRenderer.removeAllListeners('requestedFileIcon2')
        ipcRenderer.on('requestedFileIcon2', (event, icon, tag) => {
          if (filePath != tag) return
          document.getElementById('folderImg').src = icon
        })
      }

      function fileDialog() {
        let dialogid = createDialog(fs.readFileSync(cModule.path+'file.html').toString(), 'Game properties')

        //PREPARE DIALOG
        let paths = [`game://${filePath}`]
        let oldName = data.name
        let oldPath = data.path
        let oldPathClean = data.pathClean
        let oldIcon = data.icon
        let oldAdmin = (data.admin == 'true')
        let newAdmin = Boolean(oldAdmin)
        document.getElementById('fileName').value = oldName
        document.getElementById('filePath').value = oldPath
        if (!fs.existsSync(oldPathClean)) 
          document.getElementById('fileShow').style.display = 'none'
        document.getElementById('fileIcon').value = oldIcon
        document.getElementById('fileImg').src = document.getElementById(img).src
        refreshIcon()
        document.getElementById('fileAdmin').checked = oldAdmin
          

        //DIALOG LISTENERS
        clickListener('filePathFolder', function() {
          event.stopPropagation()
          let value = document.getElementById('filePath').value
          let pathInfo = getPathInfo(value)
          let path = pathInfo.pathClean.substring(0, pathInfo.pathClean.lastIndexOf('\\')+1)
          ipcRenderer.send('getFile', 'requestedFile', 'Choose a Game', path)
        })

        ipcRenderer.removeAllListeners('requestedFile')
        ipcRenderer.on('requestedFile', (event, path) => {
          if (path == '') return
          document.getElementById('filePath').value = path
          if (document.getElementById('fileName').value == '') {
            let name = path.substring(path.lastIndexOf('\\')+1)
            if (name.includes('.')) name = name.substring(0, name.lastIndexOf('.'))
            document.getElementById('fileName').value = name
          }
          refreshIcon()
        })
        
        clickListener('fileIconFolder', function() {
          event.stopPropagation()
          let value = document.getElementById('fileIcon').value
          if (value == '') value = document.getElementById('filePath').value
          let pathInfo = getPathInfo(value)
          let path = pathInfo.pathClean.substring(0, pathInfo.pathClean.lastIndexOf('\\')+1)
          ipcRenderer.send('getFile', 'requestedFileIcon', 'Choose an Icon', path)
        })

        ipcRenderer.removeAllListeners('requestedFileIcon')
        ipcRenderer.on('requestedFileIcon', (event, path) => {
          if (path == '') return
          ipcRenderer.send('getBase64', 'requestedFileBase64', path, path)
        })

        ipcRenderer.removeAllListeners('requestedFileBase64')
        ipcRenderer.on('requestedFileBase64', async function(event, base64, tag) {
          if (base64 == '') 
            document.getElementById('fileIcon').value = tag
          else {
            const result = await resizeBase64Image(base64)
            document.getElementById('fileIcon').value = result
          }
          refreshIcon()
        }) 
        
        inputListener('fileAdmin', function() {
          newAdmin = this.checked
        })  

        clickListener('fileShow', function() {
          shell.showItemInFolder(oldPathClean)
        })  

        clickListener('fileStore', function() {
          loadModule('Store', oldName)
          closeDialog(dialogid)
        })
  
        clickListener('fileMove', function() {
          moveFiles(paths, dialogid)
        })
          
        clickListener('fileRemove', function() {
          document.getElementById('removeTitle').innerHTML = `Remove '${oldName}'?`
          document.getElementById('fileWindow').style.display = 'none'
          document.getElementById('removeWindow').style.display = 'flex'
        })
        
        clickListener('removeRemove', function() {
          removeFiles(paths, dialogid)
        })

        clickListener('removeCancel', function() {
          document.getElementById('fileWindow').style.display = 'flex'
          document.getElementById('removeWindow').style.display = 'none'
        })
      
        clickListener('fileSave', function() {
          let newName = document.getElementById('fileName').value.trim()
          let newPath = document.getElementById('filePath').value.trim()
          let newIcon = document.getElementById('fileIcon').value.trim()
          if (newName == oldName && newPath == oldPath && newIcon == oldIcon && newAdmin == oldAdmin) closeDialog(dialogid)
          else if (newName == '') createNoti('Library', 'Name is necesary')
          else if (newName.includes('/')) createNoti('Library', "Forbidden character '/'")
          else if (newPath == '') createNoti('Library', 'Path is necesary')
          else {
            //GET GAME
            let item = getItem(filePath)
            if (item == undefined) {
              createNoti('Library', 'Error finding game')
              return
            }
            //CHECK IF NEW NAME EXISTS
            if (newName != oldName) {
              //GET FOLDER
              let folder = getItem(location)
              if (folder == undefined) {
                createNoti('Library', 'Error finding parent folder')
                return
              }
              //CHECK IF GAME EXISTS
              if (existsGameFrom(newName, folder)) {
                createNoti('Library', `'${newName}' already exists`)
                return
              }
            }
            //UPDATE GAME
            item.setAttribute('name', newName)
            item.setAttribute('path', newPath)
            item.setAttribute('icon', newIcon)
            item.setAttribute('admin', newAdmin)
            //SAVE FILE & CLOSE DIALOG & REFRESH LIST
            saveXML()
            closeDialog(dialogid)
            createList('refresh')
          }
        })
        
        //REFRESH ICON
        clickListener('fileImg', refreshIcon)

        function refreshIcon() {
          let icon = document.getElementById('fileIcon').value.trim()
          let path = document.getElementById('filePath').value.trim()
          if (icon != '')
            ipcRenderer.send('getIcon', 'requestedFileIcon2', icon, filePath)
          else {
            let pInfo = getPathInfo(path)
            ipcRenderer.send('getIcon', 'requestedFileIcon2', pInfo.pathClean, filePath)
          }
        }
      
        ipcRenderer.removeAllListeners('requestedFileIcon2')
        ipcRenderer.on('requestedFileIcon2', (event, icon, tag) => {
          if (filePath != tag) return
          document.getElementById('fileImg').src = icon
        })
      }

      //MOVE & REMOVE FILES
      function moveFiles(paths, dialogid) {
        //UPDATE & SHOW WINDOW
        createList('refresh')
        closeDialog(dialogid)
        if (paths.length > 1)
          document.getElementById('moveTitle').innerText = `Moving ${paths.length} items`
        else
          document.getElementById('moveTitle').innerText = `Moving ${paths.length} item`
        document.getElementById('moveWindow').style.pointerEvents = 'all'
        document.getElementById('moveWindow').style.opacity = '1'

        //LISTENERS
        clickListener('moveCancel', function() {
          document.getElementById('moveWindow').style.pointerEvents = 'none'
          document.getElementById('moveWindow').style.opacity = '0'
        })

        clickListener('moveMove', function() {
          let itemErrors = 0
          let lastError = ''
          //DESTINATION FOLDER
          let dest = getItem(libraryPath)
          if (dest == undefined) {
            createNoti('Library', 'Error finding destination folder')
            return
          }
          if (dest.tagName != 'library' && dest.tagName != 'folder') {
            createNoti('Library', 'Destination is not a folder')
            return
          }
          //CHECK IF NEW FOLDER IS ALSO BEING MOVED
          let items = []
          for (i in paths) {
            //GET ITEM
            let item = getItem(paths[i])
            if (item == undefined) {
              lastError = 'Error finding item'
              itemErrors++
              continue
            }
            items.push(item)
            //CHECK IF ITEM CONTAINS DESTINATION
            if (item.contains(dest)) {
              lastError = 'Destination is being moved'
              itemErrors++
              continue
            }
          }
          //MOVE „Éæ(‚Ä¢œâ‚Ä¢`)o
          for (i2 in items) {
            let item = items[i2]
            //CHECK IF ITEM EXISTS
            let name = getA(item, 'name')
            if (item.tagName == 'folder' && existsFolderFrom(name, dest)) {
              lastError = `'${name}' already exists`
              itemErrors++
              continue
            }
            if (item.tagName == 'game' && existsGameFrom(name, dest)) {
              lastError = `'${name}' already exists`
              itemErrors++
              continue
            }
            //MOVE ELEMENT
            dest.append(item)
          }
          //ERRORS
          if (itemErrors > 0) {
            if (itemErrors == 1) createNoti('Library', lastError)
            else createNoti('Library', `Errors: ${itemErrors}`)
          }
          //SAVE FILE & CLOSE DIALOG & REFRESH LIST
          saveXML()
          createList('refresh')
          document.getElementById('moveWindow').style.pointerEvents = 'none'
          document.getElementById('moveWindow').style.opacity = '0'
        })
      }
    
      function removeFiles(paths, dialogid) {
        let itemsRemoved = 0
        for (i in paths) {
          let path = paths[i]
          let item = getItem(path)
          if (item != undefined) {
            item.remove()
            itemsRemoved++
          }
        }
        if (itemsRemoved < paths.length) createNoti('Library', `Errors: ${paths.length - itemsRemoved}`)
        //SAVE FILE & CLOSE DIALOG & REFRESH LIST
        saveXML()
        closeDialog(dialogid)
        createList('refresh')
      }
    })
  }

  //INFO
  function saveXML() {
    //TY STACKOVERFLOW (‚úø‚ó°‚Äø‚ó°)
    let formatted = '', indent= ''
    let tab = '\t'
    libraryXML.outerHTML.split(/>\s*</).forEach(function(node) {
      if (node.match( /^\/\w/ )) indent = indent.substring(tab.length)
      formatted += indent + '<' + node + '>\r\n'
      if (node.match( /^<?\w[^>]*[^\/]$/ )) indent += tab
    })
    //SAVE FILE
    fs.writeFileSync(libraryFile, formatted.substring(1, formatted.length-3))
  }

  function getItem(path) {
    //GET ELEMENT TYPE & PARSE PATH ARRAY
    let type = ''
    if (typeof path == 'string') {
      if (path.includes('://')) {
        type = path.substring(0, path.indexOf('://'))
        path = path.substring(type.length+3)
      }
      path = path.split('/')
    }
    if (!Array.isArray(path)) return
    //GET ITEM
    let item = libraryXML
    for (i in path) {
      let goodKey = false
      let itemTmp = item
      let itemName = path[i]
      if (itemName == '') continue
      let itemElems = itemTmp.childNodes
      //CHECK IF KEY IS A FOLDER
      for (i2 in itemElems) {
        let elem = itemElems[i2]
        if (typeof elem.tagName != 'string') continue
        if (path.length-1 == i && type != '' && elem.tagName != type) continue
        if (getA(elem, 'name') == itemName) {
          goodKey = true
          itemTmp = elem
          break
        }
      }
      //IF KEY IS NOT A FOLDER RETURN
      if (!goodKey) return
      //UPDATE ITEM
      item = itemTmp
    }
    return item
  }
  
  function existsGameFrom(name, dest) {
    let olis = dest.childNodes
    for (i in olis) {
      let oli = olis[i]
      if (typeof oli.tagName != 'string') continue
      if (oli.tagName == 'game' && getA(oli, 'name') == name) return true
    }
    return false
  }

  function existsFolderFrom(name, dest) {
    let olis = dest.childNodes
    for (i in olis) {
      let oli = olis[i]
      if (typeof oli.tagName != 'string') continue
      if (oli.tagName == 'folder' && getA(oli, 'name') == name) return true
    }
    return false
  }

  function getA(item, a) {
    return item.getAttribute(a)
  }

  function getPathInfo(path) {
    let pathClean = path
    let pathArgs = []
    try {
      if (pathClean.startsWith('"') && !path.endsWith('"')) {
        pathClean = path.substring(1, path.lastIndexOf('"'))
        let args = path.substring(pathClean.length+2).trim()
        pathArgs = args.split(' ')
      }
    } catch (e) {
      pathClean = path
      pathArgs = []
    }
    if (pathClean.startsWith('"') && pathClean.endsWith('"')) pathClean = pathClean.substring(1, pathClean.length-1)
    if (pathClean.startsWith('?:')) pathClean = orion.root.substring(0, 2)+pathClean.substring(2)
    return { pathClean, pathArgs }
  }
  
  function formatText(text) {
    return String(text)
            .replace(/&/g, '&amp;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
  }

  //OPEN
  function openFile(id, admin, name, pathClean, pathArgs) {
    if (!fs.existsSync(pathClean)) 
      shell.openPath(pathClean)
    else {
      //DATA
      const path = require('path')
      const p = path.parse(pathClean)
      let folder = p.dir
      let file = p.base
      //OPEN
      if (admin && pathClean.toLowerCase().endsWith('.exe')) {
        //OPEN ADMIN
        const wincmd = require('node-windows')
        const child = wincmd.elevate(`"${file}"`, pathArgs, { cwd: folder, detached: true, stdio: 'ignore' })
        child.unref()
      } else {
        //OPEN ADMIN'T
        let cmnd = `start "" "${file}"`
        if (pathArgs.length > 0) cmnd = `start "" "${file}" ${pathArgs.join(' ')}`
        const exec = require('child_process').exec
        const child = exec(cmnd, { cwd: folder, detached: true, stdio: 'ignore' })
        child.unref()
      }
    }
    createNoti('Library', name)
  }

  function openFolder(path) {
    if (document.getElementById('window').scrollTop == 0)
      createList(path)
    else 
      $("#window").animate({ scrollTop: 0 }, "fast", function() {
        createList(path)
      })
  }
</script>