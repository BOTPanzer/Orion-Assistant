<style>
  .list {
    color: var(--textPrimary);
    overflow: hidden;
    overflow-x: auto;
    display: flex;

    padding-bottom: 5px;
    margin-left: 5px; 
    margin-right: 5px;
  }

  .listFeatured {
    flex-grow: 1;
    height: 100%;

    position: relative;
    display: flex;
    transition: all 0.4s;
    overflow: hidden;

    border-radius: var(--buttonCornerRadius);

    background: transparent;
    background-position: center;
    background-size: cover;

    color: var(--textPrimary);
    box-shadow: var(--shadow);
  }

  .listItems {
    height: 100%;
    min-width: fit-content;

    padding-top: 2px;
    padding-bottom: 2px;

    overflow-y: auto;
    overflow-x: hidden;

    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    gap: 10px 0px;

    color: var(--textPrimary);
  }
</style>

<div class="vc" style="padding: 2%; position: relative;">
  <div class="hc" style="width: 100%; align-items: center; margin-bottom: 20px;">
    <div id="title" style="padding-top: 10px; padding-bottom: 10px; color: var(--textPrimary); font-family: Special; font-size: 40px; line-height: 40px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">Home</div>
    <div id="status" class="button" style="width: 40px; min-width: 40px; height: 40px; min-height: 40px; margin-left: 10px;">
      <svg class="buttonSVG" viewBox="0 0 24 24">
        <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM9.91 16.19C9.91 16.83 9.39 17.35 8.74 17.35C8.1 17.35 7.58 16.83 7.58 16.19V12.93C7.58 12.29 8.1 11.77 8.74 11.77C9.39 11.77 9.91 12.29 9.91 12.93V16.19ZM16.42 16.19C16.42 16.83 15.9 17.35 15.26 17.35C14.61 17.35 14.09 16.83 14.09 16.19V7.81C14.09 7.17 14.61 6.65 15.26 6.65C15.9 6.65 16.42 7.17 16.42 7.81V16.19Z"/>
      </svg>
    </div>
    <div style="flex-grow: 1;"></div>
    <div class="button hc" style="width: 40%; min-width: 40%; margin-left: 10px;">
      <svg id="discover" class="buttonSVG" viewBox="0 0 24 24">
        <path d="M20.0402 6.82165L14.2802 2.79165C12.7102 1.69165 10.3002 1.75165 8.79023 2.92165L3.78023 6.83165C2.78023 7.61165 1.99023 9.21165 1.99023 10.4716V17.3716C1.99023 19.9216 4.06023 22.0016 6.61023 22.0016H17.3902C19.9402 22.0016 22.0102 19.9316 22.0102 17.3816V10.6016C22.0102 9.25165 21.1402 7.59165 20.0402 6.82165ZM12.7502 18.0016C12.7502 18.4116 12.4102 18.7516 12.0002 18.7516C11.5902 18.7516 11.2502 18.4116 11.2502 18.0016V15.0016C11.2502 14.5916 11.5902 14.2516 12.0002 14.2516C12.4102 14.2516 12.7502 14.5916 12.7502 15.0016V18.0016Z"/>
      </svg>
      <input id='editText' class="input" type="text" spellcheck="false" placeholder="Search" maxlength="30" style="flex-grow: 1; padding-left: 0; padding-right: 0;"></input>
      <svg id="search" class="buttonSVG" viewBox="0 0 24 24">
        <path class="st0" d="M2.2,21.8c-0.3-0.3-0.3-0.7,0-1l1.9-1.9c0.3-0.3,0.7-0.3,1,0s0.3,0.7,0,1l-1.9,1.9C3.1,21.9,2.9,22,2.7,22S2.3,21.9,2.2,21.8z"/>
        <path class="st0" d="M21.7,9.1c-0.8-3.3-3.5-6-6.8-6.8C7.9,0.5,1.5,6.9,3.3,13.9c0.8,3.3,3.5,6,6.8,6.8C17.1,22.5,23.5,16.1,21.7,9.1z M18.6,10c-0.1-0.3,0.1-0.7,0.5-0.7c0.3-0.1,0.6,0.1,0.7,0.4c0.1,0.6,0.2,1.2,0.2,1.8c0,0.3,0,0.7-0.1,1c-0.1,0.4-0.5,0.5-0.8,0.5c-0.2-0.1-0.5-0.3-0.5-0.6l0,0c0-0.3,0.1-0.5,0.1-0.8C18.8,10.9,18.7,10.4,18.6,10z M12.5,19C8.4,19,5,15.6,5,11.5S8.4,4,12.5,4c2.4,0,4.6,1.2,6,3c0.2,0.3,0.2,0.7-0.1,0.9C18.1,8,17.7,8,17.5,7.7l0,0c-1.1-1.5-2.9-2.5-5-2.5C9,5.3,6.3,8,6.3,11.5s2.8,6.3,6.3,6.3c0.6,0,1.2-0.1,1.8-0.3l0,0c0.4-0.1,0.8,0,0.9,0.4c0.1,0.3-0.1,0.7-0.5,0.8C14,18.9,13.2,19,12.5,19z"/>
      </svg>
    </div>
  </div>

  <div id="status-container" class="button hc" style="height: 0; margin: 0 50px; font-size: 15px; line-height: normal; justify-content: space-around; transition: all .2s, height 0s; opacity: 0; pointer-events: none;">
    <div class="hc" style="align-items: center; margin: 20px 0;">
      <div>ElAmigos</div>
      <div id="status-elamigos" style="width: 10px; height: 10px; margin-left: 10px; border-radius: 5px;"></div>
    </div>
    <div class="hc" style="align-items: center; margin: 20px 0;">
      <div>Fitgirl</div>
      <div id="status-fitgirl" style="width: 10px; height: 10px; margin-left: 10px; border-radius: 5px;"></div>
    </div>
    <div class="hc" style="align-items: center; margin: 20px 0;">
      <div >Pivi</div>
      <div id="status-pivi" style="width: 10px; height: 10px; margin-left: 10px; border-radius: 5px;"></div>
    </div>
    <div class="hc" style="align-items: center; margin: 20px 0;">
      <div>Steam Unlocked</div>
      <div id="status-steamunlocked" style="width: 10px; height: 10px; margin-left: 10px; border-radius: 5px;"></div>
    </div>
  </div>

  <div id="storeList" class="vc" style="margin: 10px 30px;">

  </div>
</div>

<script>
  //MODULE NAME CAN'T BE CHANGED FREELY (SETTINGS MODULE, TRAY & MAIN.HTML) ðŸ˜¡
  storeModulePath = currentModule
  storeLastUpdated = 0
  storeSearch = ''

  refreshData()
  storeStatus = json.storeStatus
  if (storeStatus) {
    document.getElementById('status-container').style.height = 'auto'
    document.getElementById('status-container').style.opacity = '1'
  }
  
  document.getElementById('windowBackground').style.overflowY = 'scroll'
  setStoreListeners()

  ipcRenderer.on('specialData', (event, specialData) => {
    if (specialData == undefined) specialData = ''
    searchGames(specialData)
  })

  //SEARCH FUNCTIONS
  function searchGames(search) {
    storeSearch = search
    setbuttons()
    updateModules()
    setStoreListeners()
    searchingResults('elamigos')
    searchingResults('fitgirl')
    searchingResults('pivi')
    searchingResults('steamunlocked')
    if (search == '')
      document.getElementById('title').innerHTML = 'Store'
    else
      document.getElementById('title').innerHTML = 'Store - '+search
    document.getElementById('storeList').innerHTML = ''

    search = search.toLowerCase().replaceAll(' ', '+')
    let storeUpdated = Date.now()
    storeLastUpdated = storeUpdated

    let fullURL = 'https://www.elamigos-games.com/?q='+search
    if (search == '') fullURL = 'https://www.elamigos-games.com/'
    getHTMLAgent(fullURL).then(function(result) {
      if (result == undefined) noResults('elamigos')
      else elamigos(result, storeUpdated)
    })
    
    fullURL = 'https://fitgirlrepacks.co/search/'+search
    if (search == '' || search.length < 3) fullURL = 'https://fitgirlrepacks.co/'
    getHTMLAgent(fullURL).then(function(result) {
      if (result == undefined) noResults('fitgirl')
      else fitgirl(result, storeUpdated)
    })

    fullURL = 'https://pivigames.blog/?s='+search
    if (search == '') fullURL = 'https://pivigames.blog/'
    getHTMLAgent(fullURL).then(function(result) {
      if (result == undefined) noResults('pivi')
      else pivi(result, storeUpdated)
    })

    fullURL = 'https://steamunlocked.net/?s='+search
    if (search == '') fullURL = 'https://steamunlocked.net/'
    getHTMLAgent(fullURL).then(function(result) {
      if (result == undefined) noResults('steamunlocked')
      else steamunlocked(result, search, storeUpdated)
    })
  }
  
  async function getHTMLAgent(url) {
    //process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
    const superagent = require('superagent')
    const response = await superagent.get(url).set('User-Agent', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.128 Safari/537.36').catch(function(err){ console.log(err) })
    if (response != undefined) return response.text
    else console.log('no va '+url)
  }

  //STORE FUNCTIONS
  function elamigos(result, storeUpdated) {
    if (currentModule != storeModulePath) return
    if (storeUpdated != storeLastUpdated) return
    let part = result.substring(result.indexOf('<div class="col-lg-2 '), result.indexOf('<!-- /.row -->'))
    var si = part.split('<div class="col-lg-2 ')
    var links = []
    var names = []
    var imgs = []
    var infos = []
    //LINKS & NAMES & IMAGES
    for(i in si) {
      if (links.length == 12) break
      let tmp = si[i].substring(si[i].lastIndexOf('href="')+6)
      tmp = tmp.substring(0, tmp.indexOf('<'))
      let link = tmp.substring(0, tmp.indexOf('"'))
      let name = tmp.substring(tmp.indexOf('>')+1)
      let img = si[i].substring(si[i].indexOf('src="')+5)
      img = 'https://www.elamigos-games.com'+img.substring(0, img.indexOf('"'))
      let info = si[i].substring(si[i].lastIndexOf('<small>')+7)
      info = info.substring(0, info.indexOf('</small>'))
      info = info.replaceAll('+', '').trim()
      if (link != '' && img != '' && link.startsWith('https://www.elamigos-games.com')) {
        links.push(link)
        names.push(titleCase(name))
        imgs.push(img)
        infos.push(info)
      }
    }
    //HAS RESULTS
    if (links.length != 0) createStore('elamigos', 'https://www.elamigos-games.com/', 'ElAmigos')
    else noResults('elamigos')
    //ADD GAMES
    for(i in links) {
      let id = `elamigos${i}-${Date.now()}`
      let imgid = 'img-'+id
      let img = imgs[i]
      let link = links[i]
      let name = names[i]
      let info = infos[i]
      if (info != '') html = createStoreItemHTML2(id, imgid, img, name, info)
      else html = createStoreItemHTML(id, imgid, img, name)
      document.getElementById('list-elamigos').insertAdjacentHTML('beforeend', html)
      addListener(id, link, 'elamigos', name, info, imgid)
    }
    if (document.getElementById("list-elamigos").childNodes.length > 0) document.getElementById("list-elamigos").firstChild.click()
  }

  function fitgirl(result, storeUpdated) {
    if (currentModule != storeModulePath) return
    if (storeUpdated != storeLastUpdated) return
    if (!result.includes('<article class="post')) {
      noResults('fitgirl')
      return
    }
    
    let part = result.substring(result.indexOf('<article class="post'), result.indexOf('<nav class="navigation paging-navigation"'))
    var si = part.split('<article class="post')
    var links = []
    var names = []
    //LINKS & NAMES
    for(i in si) {
      let link = si[i].substring(si[i].indexOf('href="https://fitgirlrepacks.co/repack')+6)
      link = link.substring(0, link.indexOf('"'))
      let name = si[i].substring(si[i].indexOf('rel="bookmark">')+15)
      name = name.substring(0, name.indexOf('<'))
      if (link != '' && name != '' && name != 'Upcoming repacks') {
        links.push(link)
        names.push(titleCase(name))
      }
    }
    //HAS RESULTS
    if (links.length != 0) createStore('fitgirl', 'https://fitgirl-repacks.site/', 'Fitgirl')
    else noResults('fitgirl')
    //ADD GAMES
    for(i in links) {
      let id = `fitgirl${i}-${Date.now()}`
      let imgid = 'img-'+id
      let tmp = links[i]
      tmp = tmp.substring(tmp.lastIndexOf('/'))
      tmp = tmp.substring(tmp.indexOf('-')+1)
      let link = 'https://fitgirl-repacks.site/'+tmp
      let name = names[i]
      let name2 = ''
      let info = ''
      if (name.includes('&#8211;')) {
        name2 = name.substring(0, name.indexOf('&#8211;')).trim()
        info = name.substring(name.indexOf('&#8211;')+7).trim()
      }
      let html
      if (name2 != '' && info != '') html = createStoreItemHTML2(id, imgid, './Data/Images/iconFile.png', name2, info)
      else html = createStoreItemHTML(id, imgid, './Data/Images/iconFile.png', name)
      document.getElementById('list-fitgirl').insertAdjacentHTML('beforeend', html)
      if (name2 != '') addListener(id, link, 'fitgirl', name2, info, imgid)
      else addListener(id, link, 'fitgirl', name, info, imgid)
      //IMAGE
      fitgirlImg(links[i]).then((image) =>{ 
        if (document.getElementById(imgid) != null)
        document.getElementById(imgid).style.backgroundImage = `url('${image}')`
        if (document.getElementById('link-fitgirl').innerHTML == link)
        document.getElementById('featured-fitgirl').style.backgroundImage = `url('${image}')`
      })
    }
    if (document.getElementById("list-fitgirl").childNodes.length > 0) document.getElementById("list-fitgirl").firstChild.click()

    async function fitgirlImg(link) {
      const superagent = require('superagent');
      const response = await superagent.get(link)
      let html = response.text
      
      let img = html.substring(html.indexOf('<h1 class="entry-title">'))
      img = img.substring(img.indexOf('src="')+5)
      img = img.substring(0, img.indexOf('"'))
      return img
    }
  }

  function pivi(result, storeUpdated) {
    if (currentModule != storeModulePath) return
    if (storeUpdated != storeLastUpdated) return
    let part = result.substring(result.indexOf('<div id="gp-content-wrapper"')) //remove top bar
    part = part.substring(part.indexOf('<section class="gp-post-item gp-standard-post'))
    var si = part.split('<section')
    var links = []
    var names = []
    var imgs = []
    //LINKS & NAMES & IMAGES
    for(i in si) {
      let tmp = si[i].toLowerCase()
      if (!tmp.includes('>estrenos<') && !tmp.includes('>tops<') && !tmp.includes('>promociones<') && !tmp.includes('>oferta<') && !tmp.includes('>free to play<') && !tmp.includes('>destacadas<')) {
        let link = si[i].substring(si[i].indexOf('href="')+6)
        link = link.substring(0, link.indexOf('"')-1)
        let name = si[i].substring(si[i].indexOf('title="')+7)
        name = name.substring(0, name.indexOf('"'))
        let img = si[i].substring(si[i].indexOf('src="')+5)
        img = img.substring(0, img.indexOf('"'))
        if (link != '' && name != '' && !name.toLowerCase().startsWith('sorteo') && img != '' && link.startsWith('https://pivigames.blog/') && !links.includes(link)) {
          links.push(link)
          names.push(titleCase(name))
          imgs.push(img)
        }
      }
    }
    //HAS RESULTS
    if (links.length != 0) createStore('pivi', 'https://pivigames.blog/', 'Pivi')
    else noResults('pivi')
    //ADD GAMES
    for(i in links) {
      let id = `pivi${i}-${Date.now()}`
      let imgid = 'img-'+id
      let img = imgs[i]
      let link = links[i]
      let name = names[i]
      let name2 = ''
      let info = ''
      if (name.toLowerCase().includes('pc ')) {
        name2 = name.substring(0, name.toLowerCase().indexOf('pc ')).trim()
        info = name.substring(name.toLowerCase().indexOf('pc ')+2).replaceAll('+', '').trim()
      }
      if (name2 != '' && info != '') html = createStoreItemHTML2(id, imgid, img, name2, info)
      else html = createStoreItemHTML(id, imgid, img, name)
      document.getElementById('list-pivi').insertAdjacentHTML('beforeend', html)
      if (name2 != '') addListener(id, link, 'pivi', name2, info, imgid)
      else addListener(id, link, 'pivi', name, info, imgid)
    }
    if (document.getElementById("list-pivi").childNodes.length > 0) document.getElementById("list-pivi").firstChild.click()
  }

  function steamunlocked(result, search, storeUpdated) {
    if (currentModule != storeModulePath) return
    if (storeUpdated != storeLastUpdated) return
    var si
    if (search != '') {
      let part = result.substring(result.indexOf('class="cover-items"')) //remove top
      part = part.substring(0, part.indexOf('class="col-lg-4"')) //to bot
      si = part.split('class="cover-item category"')
    } else {
      let part = result.substring(result.indexOf('class="vc_pageable-slide-wrapper vc_clearfix"')) //remove top
      part = part.substring(0, part.indexOf('class="vc_pageable-load-more-btn"')) //to bot
      si = part.split('class="vc_grid-item vc_clearfix')
    }
    var links = []
    var names = []
    var imgs = []
    //LINKS & NAMES & IMAGES
    for(i in si) {
      if (links.length == 12) break
      let link = si[i].substring(si[i].indexOf('href="')+6)
      link = link.substring(0, link.indexOf('"')-1)
      let name
      if (search != '') {
        name = si[i].substring(si[i].indexOf('<h1>')+4)
        name = name.substring(0, name.indexOf('</h1>'))
      } else {
        name = si[i].substring(si[i].indexOf('title="')+7)
        name = name.substring(0, name.indexOf('"'))
      }
      let img = si[i].substring(si[i].lastIndexOf('src="')+5)
      img = img.substring(0, img.indexOf('"'))
      if (link != '' && name != '' && img != '') {
        links.push(link)
        names.push(titleCase(name))
        imgs.push(img)
      }
    }
    //HAS RESULTS
    if (links.length != 0) createStore('steamunlocked', 'https://steamunlocked.net/', 'Steam Unlocked')
    else noResults('steamunlocked')
    //ADD GAMES
    for(i in links) {
      let id = `steamunlocked${i}-${Date.now()}`
      let imgid = 'img-'+id
      let img = imgs[i]
      let link = links[i]
      let name = names[i]
      let name2 = ''
      let info = ''
      if (name.toLowerCase().includes('free download')) {
        name2 = name.substring(0, name.toLowerCase().indexOf('free download')).trim()
        info = name.substring(name.toLowerCase().indexOf('free download')+13).trim()
      }
      if (name2 != '' && info != '') html = createStoreItemHTML2(id, imgid, img, name2, info)
      else if (name2 != '') html = createStoreItemHTML(id, imgid, img, name2)
      else html = createStoreItemHTML(id, imgid, img, name)

      document.getElementById('list-steamunlocked').insertAdjacentHTML('beforeend', html)

      if (name2 != '') addListener(id, link, 'steamunlocked', name2, info, imgid)
      else addListener(id, link, 'steamunlocked', name, info, imgid)
    }
    if (document.getElementById("list-steamunlocked").childNodes.length > 0) document.getElementById("list-steamunlocked").firstChild.click()
  }

  //RESULTS FUNCTIONS
  function createStore(id, store, name) {
    document.getElementById('status-'+id).style.background = 'var(--positive)'
    let html = createStoreHTML(id, store, name)
    document.getElementById('storeList').insertAdjacentHTML('beforeend', html)

    addButtonListener('open-'+id, function() {
      let link = document.getElementById('link-'+id).innerHTML
      let name = document.getElementById('name-'+id).innerHTML
      if (name.includes('<div style')) name = name.substring(0, name.indexOf('<div style'))
      createNoti('Store:', name)
      openLink(link)
    })     

    addButtonListener('preview-'+id, function() {
      let link = document.getElementById('link-'+id).innerHTML
      let name = document.getElementById('name-'+id).innerHTML
      if (name.includes('<div style')) name = name.substring(0, name.indexOf('<div style'))
      createNoti('Store:', name)
      ipcRenderer.send('newSimpleWindow', link)
    })  
  }

  function searchingResults(id) {
    document.getElementById('status-'+id).style.background = 'var(--searching)'
  }

  function noResults(id) {
    document.getElementById('status-'+id).style.background = 'var(--negative)'
  }

  //HTML FUNCTIONS
  function titleCase(str) {
    var splitStr = str.toLowerCase().split(' ');
    for (var i = 0; i < splitStr.length; i++) {
      splitStr[i] = splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1);     
    }
    return splitStr.join(' '); 
  }

  function createStoreItemHTML(id, img, icon, name) {
    return `<div class="button" id="${id}" style="width: 260px; min-height: 120px; display: flex; margin-left: 10px; margin-right: 8px;">
              <div id="${img}" style="min-width: 80px; min-height: 100px; margin: 10px; border-radius: inherit; box-shadow: inherit; background: url('${icon}'); background-size: cover; background-position: center; background-repeat: no-repeat;"></div>
              <div style="width: 150px; margin: 10px 10px 10px 0; display: flex; flex-direction: column;">
                <div id="name-${id}" style="width: 140px; margin: auto; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; text-overflow: ellipsis; overflow: hidden; font-size: 15px; line-height: 17px;">${name}</div>
              </div>
            </div>`
  }

  function createStoreItemHTML2(id, img, icon, name, info) {
    return `<div class="button" id="${id}" style="width: 260px; min-height: 120px; display: flex; margin-left: 10px; margin-right: 8px;">
              <div id="${img}" style="min-width: 80px; min-height: 100px; margin: 10px; border-radius: inherit; box-shadow: inherit; background: url('${icon}'); background-size: cover; background-position: center; background-repeat: no-repeat;"></div>
              <div style="width: 150px; margin: 10px 10px 10px 0; display: flex; flex-direction: column;">
                <div id="name-${id}" style="width: 140px; margin: auto; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; text-overflow: ellipsis; overflow: hidden; font-size: 15px; line-height: 17px;">${name}</div>
                <div style="width: 140px; margin: auto; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; text-overflow: ellipsis; overflow: hidden; font-size: 13px; line-height: 15px; color: var(--textSecondary);">${info}</div>
              </div>
            </div>`
  }

  function createStoreHTML(id, store, name) {
    return `
    <div class="hc" style="margin-bottom: 5px; font-family: Main; font-weight: bold; align-items: center;">
      <svg class="buttonSVG" viewBox="0 0 24 24" style="margin: 7px 0; fill: var(--textPrimary);">
        <path d="M19.8305 8.6998L15.3005 4.1698C14.3505 3.2198 13.0405 2.7098 11.7005 2.7798L6.70046 3.0198C4.70046 3.1098 3.11046 4.6998 3.01046 6.6898L2.77046 11.6898C2.71046 13.0298 3.21046 14.3398 4.16046 15.2898L8.69046 19.8198C10.5505 21.6798 13.5705 21.6798 15.4405 19.8198L19.8305 15.4298C21.7005 13.5798 21.7005 10.5598 19.8305 8.6998ZM9.50046 12.3798C7.91046 12.3798 6.62046 11.0898 6.62046 9.4998C6.62046 7.9098 7.91046 6.6198 9.50046 6.6198C11.0905 6.6198 12.3805 7.9098 12.3805 9.4998C12.3805 11.0898 11.0905 12.3798 9.50046 12.3798Z"/>
      </svg>
      <div id="title-${id}" style="width: fit-content; padding: 5px; color: var(--textPrimary); font-size: 16px; line-height: 16px; white-space: nowrap;">${name}</div>
      <svg id="more-${id}" class="button-elevated buttonSVG" onclick="openStore('${name}', '${store}')" viewBox="0 0 24 24" fill="var(--textPrimary)" style="margin-left: auto;">
        <path d="M22.3596 8.27L22.0696 5.5C21.6496 2.48 20.2796 1.25 17.3497 1.25H14.9896H13.5097H10.4697H8.98965H6.58965C3.64965 1.25 2.28965 2.48 1.85965 5.53L1.58965 8.28C1.48965 9.35 1.77965 10.39 2.40965 11.2C3.16965 12.19 4.33965 12.75 5.63965 12.75C6.89965 12.75 8.10965 12.12 8.86965 11.11C9.54965 12.12 10.7097 12.75 11.9997 12.75C13.2896 12.75 14.4197 12.15 15.1096 11.15C15.8797 12.14 17.0696 12.75 18.3096 12.75C19.6396 12.75 20.8396 12.16 21.5896 11.12C22.1896 10.32 22.4597 9.31 22.3596 8.27Z"/>
        <path d="M11.3491 16.6602C10.0791 16.7902 9.11914 17.8702 9.11914 19.1502V21.8902C9.11914 22.1602 9.33914 22.3802 9.60914 22.3802H14.3791C14.6491 22.3802 14.8691 22.1602 14.8691 21.8902V19.5002C14.8791 17.4102 13.6491 16.4202 11.3491 16.6602Z"/>
        <path d="M21.3709 14.3981V17.3781C21.3709 20.1381 19.1309 22.3781 16.3709 22.3781C16.1009 22.3781 15.8809 22.1581 15.8809 21.8881V19.4981C15.8809 18.2181 15.4909 17.2181 14.7309 16.5381C14.0609 15.9281 13.1509 15.6281 12.0209 15.6281C11.7709 15.6281 11.5209 15.6381 11.2509 15.6681C9.47086 15.8481 8.12086 17.3481 8.12086 19.1481V21.8881C8.12086 22.1581 7.90086 22.3781 7.63086 22.3781C4.87086 22.3781 2.63086 20.1381 2.63086 17.3781V14.4181C2.63086 13.7181 3.32086 13.2481 3.97086 13.4781C4.24086 13.5681 4.51086 13.6381 4.79086 13.6781C4.91086 13.6981 5.04086 13.7181 5.16086 13.7181C5.32086 13.7381 5.48086 13.7481 5.64086 13.7481C6.80086 13.7481 7.94086 13.3181 8.84086 12.5781C9.70086 13.3181 10.8209 13.7481 12.0009 13.7481C13.1909 13.7481 14.2909 13.3381 15.1509 12.5981C16.0509 13.3281 17.1709 13.7481 18.3109 13.7481C18.4909 13.7481 18.6709 13.7381 18.8409 13.7181C18.9609 13.7081 19.0709 13.6981 19.1809 13.6781C19.4909 13.6381 19.7709 13.5481 20.0509 13.4581C20.7009 13.2381 21.3709 13.7181 21.3709 14.3981Z"/>
      </svg>
    </div>
    <div style="height: var(--storeListHeight); margin-bottom: 30px; display: flex;">
      <div id="featured-${id}" class="listFeatured">
        <div style="width: fit-content; max-width: 90%; height: fit-content; position: absolute; bottom: 0; display: flex; flex-direction: column;">
          <div style="width: 100%; height: 100%; position: absolute; border-radius: var(--buttonCornerRadius); border-top-left-radius: 0; border-bottom-right-radius: 0; background: var(--button); opacity: 0.3;"></div>
          <div style="width: 100%; height: 100%; position: absolute; border-radius: var(--buttonCornerRadius); border-top-left-radius: 0; border-bottom-right-radius: 0; box-shadow: 0 0 1rem 0 rgba(0, 0, 0, .2); backdrop-filter: blur(6px);"></div>
          <div style="width: 100%; height: 100%; position: relative; display: flex; flex-direction: column;">
            <div style="flex-grow: 1; margin: 20px; display: flex; align-items: center;">
              <div id="name-${id}" style="flex-grow: 1; font-size: 15px; line-height: normal; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical;">Name</div>
              <div id="preview-${id}" class="button buttonEmoteText" style="min-width: 40px; height: 40px; margin: 0 10px 0 20px;">ðŸ‘€</div>
              <div id="open-${id}" class="button buttonText hc" style="width: fit-content; min-width: fit-content; height: 40px; min-height: 40px; padding: 0px 20px; align-items: center;">Open</div>
              <div id="link-${id}" style="display: none;"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="listItems" id="list-${id}"></div>
    </div>`
  }

  //OTHER FUNCTIONS
  function setStoreListeners() {
    const storeResizeOb = new ResizeObserver(function(entries) {
      let contentW = document.getElementById('window').offsetWidth
      document.body.style.setProperty('--storeListHeight', contentW/2.7+'px')
    })
    storeResizeOb.observe(document.querySelector("#window"))

    addButtonListener('status', function() {
      if ($('#status-container').is(':animated')) return
      if (storeStatus) {
        $('#status-container').animate({height: '0'}, 200, function() {
          document.getElementById('status-container').style.opacity = '0'
          storeStatus = false
          setData('storeStatus', storeStatus)
        })
      } else {
        var el = $('#status-container'),
        curHeight = el.height(),
        autoHeight = el.css('height', 'auto').height()
        document.getElementById('status-container').style.opacity = '1'
        el.height(curHeight).animate({height: autoHeight}, 200, function() {
          storeStatus = true
          setData('storeStatus', storeStatus)
        })
      }
    })

    addButtonListener('discover', function() {
      if (storeSearch != '')
        searchGames('')
    })

    $('#editText').bind('keydown', function(event) {
      if (event.keyCode === 13) {
        event.preventDefault();
        let search = document.getElementById('editText').value
        if (search == '') return
        searchGames(search)
        return false;
      }
    })

    addButtonListener('search', function() {
      let search = document.getElementById('editText').value
      if (search == '') return
      searchGames(search)
    })
  }

  function addListener(id, link, store, name, info, img) {
    addButtonListener(id, function() {
      document.getElementById('featured-'+store).style.backgroundImage = document.getElementById(img).style.backgroundImage
      if (info == '') document.getElementById('name-'+store).innerHTML = name
      else document.getElementById('name-'+store).innerHTML = name+'<div style="font-size: 13px;"><br />'+info+'</div>'
      document.getElementById('link-'+store).innerHTML = link
    })

    addRightButtonListener(id, function() {
      let url = document.getElementById(img).style.backgroundImage
      ipcRenderer.send('newSimpleWindow', url.substring(5, url.length-2), false, true, 540, 540)
    })
  }

  function openStore(name, link) {
    createNoti('Store:', name+' Official Page')
    shell.openExternal(link)
  }

  function openLink(link) {
    shell.openExternal(link)
  }

  function addScroll(id) {
    $('#'+id).bind('wheel', function() {
      if ($('#'+id).hasScrollBar()) {
        this.scrollLeft -= (event.wheelDelta/1.5)
        event.preventDefault()
      }
    })
  }

  jQuery.fn.hasScrollBar = function(direction) {
    return this.get(0).scrollWidth > this.innerWidth();
  }
</script>