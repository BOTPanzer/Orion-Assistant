<style>
  .todo {
    width: 100%;
  }

  .todo div {
    width: calc(100% - 50px);
    height: 40px; 
    padding: 0 10px 0 40px; 
    font-size: 15px;
    line-height: 40px;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
</style>

<div class="win-c">
  <div class="win-t">
    <div id="title" class="title">To Do</div>
    <div id="todoAddC" class="button" style="width: 40px; min-width: 40px; height: 40px; min-height: 40px; margin-left: 10px;">
      <svg class="svg" viewBox="0 0 24 24">
        <path d="M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM16 12.75H12.75V16C12.75 16.41 12.41 16.75 12 16.75C11.59 16.75 11.25 16.41 11.25 16V12.75H8C7.59 12.75 7.25 12.41 7.25 12C7.25 11.59 7.59 11.25 8 11.25H11.25V8C11.25 7.59 11.59 7.25 12 7.25C12.41 7.25 12.75 7.59 12.75 8V11.25H16C16.41 11.25 16.75 11.59 16.75 12C16.75 12.41 16.41 12.75 16 12.75Z"/>
      </svg>
    </div>
  </div>

  <div class="vc" id="themesEmpty" style="width: 100%; align-items: center; line-height: normal; display: none;">
    <div style="font-size: 100px; margin-top: 20px;">ðŸ™‰</div>
    <div style="font-size: 15px; color: var(--textPrimary);">Free Time!!</div>
    <div style="font-size: 15px; color: var(--textSecondary);">There is Nothing to do</div>
  </div>
  <div class="vc" id="todoList" style="flex-wrap: wrap; gap: 20px;">
  
  </div>
</div>

<script>
  // /$$    /$$  /$$$$$$  /$$$$$$$  /$$$$$$  /$$$$$$  /$$$$$$$  /$$       /$$$$$$$$  /$$$$$$ 
  //| $$   | $$ /$$__  $$| $$__  $$|_  $$_/ /$$__  $$| $$__  $$| $$      | $$_____/ /$$__  $$
  //| $$   | $$| $$  \ $$| $$  \ $$  | $$  | $$  \ $$| $$  \ $$| $$      | $$      | $$  \__/
  //|  $$ / $$/| $$$$$$$$| $$$$$$$/  | $$  | $$$$$$$$| $$$$$$$ | $$      | $$$$$   |  $$$$$$ 
  // \  $$ $$/ | $$__  $$| $$__  $$  | $$  | $$__  $$| $$__  $$| $$      | $$__/    \____  $$
  //  \  $$$/  | $$  | $$| $$  \ $$  | $$  | $$  | $$| $$  \ $$| $$      | $$       /$$  \ $$
  //   \  $/   | $$  | $$| $$  | $$ /$$$$$$| $$  | $$| $$$$$$$/| $$$$$$$$| $$$$$$$$|  $$$$$$/
  //    \_/    |__/  |__/|__/  |__/|______/|__/  |__/|_______/ |________/|________/ \______/

  todoFolder = currentModule+'Todo\\'
  addedToDo = false

  //  /$$$$$$   /$$$$$$  /$$$$$$$  /$$$$$$$$
  // /$$__  $$ /$$__  $$| $$__  $$| $$_____/
  //| $$  \__/| $$  \ $$| $$  \ $$| $$      
  //| $$      | $$  | $$| $$  | $$| $$$$$   
  //| $$      | $$  | $$| $$  | $$| $$__/   
  //| $$    $$| $$  | $$| $$  | $$| $$      
  //|  $$$$$$/|  $$$$$$/| $$$$$$$/| $$$$$$$$
  // \______/  \______/ |_______/ |________/

  //SHOW SCROLLBAR
  document.getElementById('window').style.overflowY = 'scroll'

  //TODO FOLDER
  if (!fs.existsSync(todoFolder)) fs.mkdirSync(todoFolder)

  //CREATE LIST
  createToDoList()


  // /$$       /$$$$$$  /$$$$$$  /$$$$$$$$ /$$$$$$$$ /$$   /$$ /$$$$$$$$ /$$$$$$$   /$$$$$$ 
  //| $$      |_  $$_/ /$$__  $$|__  $$__/| $$_____/| $$$ | $$| $$_____/| $$__  $$ /$$__  $$
  //| $$        | $$  | $$  \__/   | $$   | $$      | $$$$| $$| $$      | $$  \ $$| $$  \__/
  //| $$        | $$  |  $$$$$$    | $$   | $$$$$   | $$ $$ $$| $$$$$   | $$$$$$$/|  $$$$$$ 
  //| $$        | $$   \____  $$   | $$   | $$__/   | $$  $$$$| $$__/   | $$__  $$ \____  $$
  //| $$        | $$   /$$  \ $$   | $$   | $$      | $$\  $$$| $$      | $$  \ $$ /$$  \ $$
  //| $$$$$$$$ /$$$$$$|  $$$$$$/   | $$   | $$$$$$$$| $$ \  $$| $$$$$$$$| $$  | $$|  $$$$$$/
  //|________/|______/ \______/    |__/   |________/|__/  \__/|________/|__/  |__/ \______/

  //ADD CATEGORY
  clickListener('todoAddC', function() {
    let dialogid = createDialog(fs.readFileSync(currentModule+'addCat.html').toString(), 'Add List')
    
    //DIALOG LISTENERS
    $('#addCatName').on('keydown', function(event) {
      if (event.keyCode === 13) {
        event.preventDefault()
        document.getElementById('addCatAdd').click()
        return false
      }
    })

    clickListener('addCatAdd', function() {
      let name = document.getElementById('addCatName').value
      if (name == '') {
        createNoti('To Do', 'Name Is Necesary')
        return
      }
      
      let fullName = todoFolder+name.trim()
      if (!fs.existsSync(fullName)) {
        fs.mkdirSync(fullName)
        closeDialog(dialogid)
        createToDoList()
      } else createNoti('To Do', `"${name}" Already Exists`)
    })
  })


  // /$$$$$$$$ /$$   /$$ /$$   /$$  /$$$$$$  /$$$$$$$$ /$$$$$$  /$$$$$$  /$$   /$$  /$$$$$$ 
  //| $$_____/| $$  | $$| $$$ | $$ /$$__  $$|__  $$__/|_  $$_/ /$$__  $$| $$$ | $$ /$$__  $$
  //| $$      | $$  | $$| $$$$| $$| $$  \__/   | $$     | $$  | $$  \ $$| $$$$| $$| $$  \__/
  //| $$$$$   | $$  | $$| $$ $$ $$| $$         | $$     | $$  | $$  | $$| $$ $$ $$|  $$$$$$ 
  //| $$__/   | $$  | $$| $$  $$$$| $$         | $$     | $$  | $$  | $$| $$  $$$$ \____  $$
  //| $$      | $$  | $$| $$\  $$$| $$    $$   | $$     | $$  | $$  | $$| $$\  $$$ /$$  \ $$
  //| $$      |  $$$$$$/| $$ \  $$|  $$$$$$/   | $$    /$$$$$$|  $$$$$$/| $$ \  $$|  $$$$$$/
  //|__/       \______/ |__/  \__/ \______/    |__/   |______/ \______/ |__/  \__/ \______/

  function createToDoList() {
    if (!fs.existsSync(todoFolder)) return
    addedToDo = false
    $('#todoList *').off()
    document.getElementById('todoList').innerHTML = ''
    document.getElementById('themesEmpty').style.display = 'none'
    //START
    let paths = fs.readdirSync(todoFolder)
    //FIRST FOLDERS THEN FILES
    let folders = []
    let files = []
    for(i in paths) {
      let path = todoFolder+paths[i]
      if (fs.statSync(path).isFile())
        files.push(paths[i])
      else
        folders.push(paths[i])
    }
    //addCategory('', files, 'todo')
    for (i in folders) {
      let folder = folders[i]
      let id = 'todo'+i
      let tmp = fs.readdirSync(todoFolder+folder)
      let files2 = []
      for(i in tmp) {
        let path = todoFolder+folder+'\\'+tmp[i]
        if (fs.statSync(path).isFile() && path.toLowerCase().endsWith('.json'))
          files2.push(tmp[i])
      }
      addList(folder, files2, id)
    }
    
    if (!addedToDo) document.getElementById('themesEmpty').style.display = 'flex'
  }

  function addList(folder, files, id) {
    addedToDo = true
    //CREATE CATEGORY
    let title = folder
    if (title == '') title = 'To Do'
    let d1 = `<div>
                <div id="title-${id}" class="button text" style="margin-bottom: 5px; padding-right: 0; --oBackground: transparent; --oBorderC: transparent;">
                  ${title}
                  <svg class="svg" viewBox="0 0 24 24">
                    <path d="M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM16 12.75H12.75V16C12.75 16.41 12.41 16.75 12 16.75C11.59 16.75 11.25 16.41 11.25 16V12.75H8C7.59 12.75 7.25 12.41 7.25 12C7.25 11.59 7.59 11.25 8 11.25H11.25V8C11.25 7.59 11.59 7.25 12 7.25C12.41 7.25 12.75 7.59 12.75 8V11.25H16C16.41 11.25 16.75 11.59 16.75 12C16.75 12.41 16.41 12.75 16 12.75Z"/>
                  </svg>
                </div>
                <div id="${id}" class="vc" style="gap: 10px; font-size: 15px;"></div>
              </div>`
    document.getElementById('todoList').insertAdjacentHTML('beforeend', d1)
    //ADD CATEGORY LISTENERS
    clickListener('title-'+id, function() {
      let dialogid = createDialog(fs.readFileSync(currentModule+'addItem.html').toString(), 'Add Item')
    
      //DIALOG LISTENERS
      $('#addItemName').on('keydown', function(event) {
        if (event.keyCode === 13) {
          event.preventDefault()
          document.getElementById('addItemAdd').click()
          return false
        }
      })

      clickListener('addItemAdd', function() {
        let name = document.getElementById('addItemName').value.trim()
        if (name == '') {
          createNoti('To Do', 'Name Is Necesary')
          return
        }
      
        let fullName = todoFolder+folder+'\\'+'item'+Date.now()+'.json'
        if (!fs.existsSync(fullName)) {
          fs.writeFileSync(fullName, JSON.stringify({ checked: false, name: name }))
          closeDialog(dialogid)
          createToDoList()
        } else createNoti('To Do', `"${name}" Already Exists`)
      })
    })
    clickRightListener('title-'+id, function() {
      let dialogid = createDialog(fs.readFileSync(currentModule+'cat.html').toString(), 'List Menu')        

      //PREPARE DIALOG
      document.getElementById('catTitle').innerHTML = '"'+title+'" List Selected'

      //DIALOG LISTENERS
      clickListener('catRename', function() {
        document.getElementById('catWindow').style.display = 'none'
        document.getElementById('renameWindow').style.display = 'flex'
      })

      $('#renameName').on('keydown', function(event) {
        if (event.keyCode === 13) {
          event.preventDefault()
          document.getElementById('renameRename').click()
          return false
        }
      })

      clickListener('renameRename', function() {
        let name = document.getElementById('renameName').value.trim()
        if (name == '') {
          createNoti('To Do', 'Name Is Necesary')
          return
        }
      
        let fullName = todoFolder+name
        if (name == folder) 
        closeDialog(dialogid)
        else if (!fs.existsSync(fullName)) {
          fs.renameSync(todoFolder+folder, fullName)
          closeDialog(dialogid)
          createToDoList()
        } else createNoti('To Do', `"${name}" Already Exists`)
      })
  
      clickListener('catRemove', function() {
        document.getElementById('removeTitle').innerHTML = 'Remove "'+title+'"?'
        document.getElementById('catWindow').style.display = 'none'
        document.getElementById('removeWindow').style.display = 'flex'
      })
  
      clickListener('removeRemove', function() {
        fs.rmSync(todoFolder+folder, { recursive: true })
        closeDialog(dialogid)
        createToDoList()
      })

      clickListener('removeCancel', function() {
        document.getElementById('catWindow').style.display = 'flex'
        document.getElementById('removeWindow').style.display = 'none'
      })
    })
    //ADD ITEMS TO CATEGORY
    for (i in files) {
      //VARIABLES
      let file = files[i]
      let itemId = id+'i'+i
      let filePath = todoFolder+folder+'\\'+file
      //DATA
      let data = {}
      try {
        data = JSON.parse(fs.readFileSync(filePath))
        if (data.name == undefined) data.name = 'To Do Item'
      } catch {
        data = {
          checked: false,
          name: 'To Do Item'
        }
      }
      //CREATE ITEM
      let d2 = `<div id="box-${itemId}" class="button todo">
                  <div>${data.name}</div>
                  <input id="${itemId}" class="button checkbox" hover="" type="checkbox" style="width: 100%; margin: 5px; position: absolute; --oBackground: transparent; --oBorderC: transparent;"/>
                </div>`
      document.getElementById(id).insertAdjacentHTML('beforeend', d2)
      if (data.checked) document.getElementById(itemId).checked = true
      checkboxListener(itemId, function() {
        data.checked = true
        fs.writeFileSync(filePath, JSON.stringify(data))
      }, function() {
        data.checked = false
        fs.writeFileSync(filePath, JSON.stringify(data))
      })
      clickRightListener(itemId, function() {
        let dialogid = createDialog(fs.readFileSync(currentModule+'item.html').toString(), 'Item Menu')      

        //PREPARE DIALOG
        document.getElementById('itemTitle').innerHTML = '"'+data.name+'" Item Selected'

        //DIALOG LISTENERS
        clickListener('itemRename', function() {
          document.getElementById('itemWindow').style.display = 'none'
          document.getElementById('renameWindow').style.display = 'flex'
        })

        $('#renameName').on('keydown', function(event) {
          if (event.keyCode === 13) {
            event.preventDefault()
            document.getElementById('renameRename').click()
            return false
          }
        })

        clickListener('renameRename', function() {
          let name = document.getElementById('renameName').value.trim()
          if (name == '') {
            createNoti('To Do', 'Name Is Necesary')
            return
          }

          data.name = name
          fs.writeFileSync(filePath, JSON.stringify(data))
          closeDialog(dialogid)
          createToDoList()
        })
    
        clickListener('itemRemove', function() {
          document.getElementById('removeTitle').innerHTML = 'Remove "'+data.name+'"?'
          document.getElementById('itemWindow').style.display = 'none'
          document.getElementById('removeWindow').style.display = 'flex'
        })
    
        clickListener('removeRemove', function() {
          fs.unlinkSync(filePath)
          closeDialog(dialogid)
          createToDoList()
        })

        clickListener('removeCancel', function() {
          document.getElementById('itemWindow').style.display = 'flex'
          document.getElementById('removeWindow').style.display = 'none'
        })
      })
    }
    if (files.length == 0 && folder == '') document.getElementById(id).innerHTML = `<div style="margin-left: 20px;">Try Adding an Item From the (+) Button</div>`
  }
</script>