<div class="vc" style="padding: 2%;">
  <div class="hc" style="flex-grow: 1; align-items: center; margin-bottom: 20px;">
    <div id="title" style="padding-top: 10px; padding-bottom: 10px; font-family: Special; font-size: 40px; line-height: 40px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; color: var(--textPrimary);">Settings</div>
    <div style="flex-grow: 1;"></div>
    <div class="buttonText" style="margin: 0 10px;">Restart:</div>
    <div id="restart" class="button buttonEmoteText" style="width: 40px; min-width: 40px; height: 40px; min-height: 40px;">‚Ü∫</div>
  </div>
  
  <div class="hc" style="flex-grow: 1; align-items: center; margin-bottom: 10px;">
    <div style="padding-top: 10px; padding-bottom: 10px; font-family: Special; font-size: 30px; line-height: 30px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; color: var(--textPrimary);">‚Ä¢ Window</div>
    <div style="flex-grow: 1;"></div>
    <div id="windowReset" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px;">Reset Size</div>
  </div>

  <div class="hc" style="flex-grow: 1; align-items: center; margin-bottom: 10px;">
    <div style="padding-top: 10px; padding-bottom: 10px; font-family: Special; font-size: 30px; line-height: 30px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden; color: var(--textPrimary);">‚Ä¢ Modules</div>
    <div id="modulesLog" style="width: fit-content; height: 20px; font-size: 15px; line-height: 15px; margin: 0 10px; display: flex; align-items: center; color: var(--textPrimary);"></div>
    <div style="flex-grow: 1;"></div>
    <div id="modulesSwitchLog" style="width: fit-content; height: 20px; font-size: 15px; line-height: 15px; margin: 0 10px; display: flex; align-items: center; color: var(--textPrimary);"></div>
    <div class="button switch-emote" style="width: 80px; height: 40px;">
      <input id="modulesSwitch" type="checkbox"/>
      <div style="width: 40px;"></div>
      <div class="buttonEmoteText" style="width: 40px;">üëÄ</div>
      <div class="buttonEmoteText" style="width: 40px;">üóëÔ∏è</div>
    </div>
    <div id="modulesAdd" class="button buttonEmoteText" style="width: 40px; min-width: 40px; height: 40px; min-height: 40px; margin-left: 10px;">+</div>
  </div>
  <div class="hc" style="flex-grow: 1; position: relative; justify-content: space-around; margin-bottom: 20px;">
    <div class="hc">
      <div class="vc" style="width: 170px; text-align: center; align-items: center; padding-top: 20px; padding-bottom: 20px;">
        <div style="font-size: 15px; line-height: 15px; color: var(--textPrimary);">Shown</div>
        <div class="vc" id="modulesShown" style="padding-left: 20px; padding-right: 20px;"></div>
      </div>
      <div style="width: 1px; margin-top: 5px; margin-bottom: 5px; background-color: var(--textPrimary); opacity: 0.5;"></div>
      <div class="vc" style="width: 170px; text-align: center; align-items: center; padding-top: 20px; padding-bottom: 20px;">
        <div style="font-size: 15px; line-height: 15px; color: var(--textPrimary);">Hidden</div>
        <div class="vc" id="modulesHidden" style="padding-left: 20px; padding-right: 20px;"></div>
      </div>
    </div>
    <div id="modulesRemove" style="width: 100%; height: 100%; display: none; align-items: center; position: absolute;">
      <div class="vc" style="width: 390px; height: fit-content; margin: auto; background: var(--background); border-radius: 10px; box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(126, 126, 126, .2) 0px 0px 0px 1px;">
        <div id="modulesRemoveTitle" style="margin: 20px; font-size: 17px; color: var(--textPrimary);">Remove Module?</div>
        <div id="modulesRemovePath" style="display: none;"></div>
        <div class="hc" style="margin: 0 auto 20px auto">
          <div id="modulesRemoveConfirm" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px; margin-right: 10px;">Remove</div>
          <div id="modulesRemoveCancel" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px;">Cancel</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  //MODULE NAME CAN'T BE CHANGED FREELY (TRAY & MAIN.HTML) üò°
  modulesRemoving = false
  document.getElementById('modulesSwitchLog').innerHTML = 'Visibility Tool:'
  document.getElementById("modulesSwitch").checked = modulesRemoving

  addModulesShown()
  addModulesHidden()

  //RESTART
  addButtonListener('restart', function() {
    ipcRenderer.send('reloadAssistant')
  })

  //WINDOW
  addButtonListener('windowReset', function() {
    win.unmaximize()
    win.setSize(960, 550)
    win.center()
  })

  //MODULES
  addButtonListener('modulesRemove', function() {
    document.getElementById('modulesRemove').style.display = 'none'
  })

  addButtonListener('modulesRemoveCancel', function() {
    document.getElementById('modulesRemove').click()
  })

  addButtonListener('modulesRemoveConfirm', function() {
    let name = document.getElementById('modulesRemovePath').innerHTML 
    const rimraf = require("rimraf")
    rimraf(data.modules+name, (err) => {
      addModulesShown()
      addModulesHidden()
      document.getElementById('modulesRemove').click()
    })
  })

  addCheckboxListener('modulesSwitch', function() {
    modulesRemoving = true
    document.getElementById('modulesSwitchLog').innerHTML = 'Remove Tool:'
  }, function() {
    modulesRemoving = false
    document.getElementById('modulesSwitchLog').innerHTML = 'Visibility Tool:'
  })

  addButtonListener('modulesAdd', function() {
    ipcRenderer.send('getFile', '', 'Module .Zip File', 'moduleFileGotten')
  })

  ipcRenderer.on('moduleFileGotten', (event, path) => {
    if (path == '') return
    if (!path.toLowerCase().endsWith('.zip')) {
      document.getElementById('modulesLog').innerHTML = 'Invalid File Format'
      return
    }
    ipcRenderer.send('pause')
    let exec = require('child_process').exec
    document.getElementById('modulesLog').innerHTML = 'Installing Module...'
    exec(`"${data.zip}" l "${path}" -x!*\\*`, function (error, stdOut, stdErr) {
      if (!(error || stdErr)) {
        if (stdOut.replaceAll('\r', '').replaceAll('\n', '').endsWith('0 files, 1 folders')) { 
          exec(`"${data.zip}" x "${path}" -o"${data.modules}"`, function (error, stdOut, stdErr) {
            if (!(error || stdErr)) {
              //INSTALLED
              ipcRenderer.send('resume')
              document.getElementById('title').innerHTML = 'Module Installed'
              addModulesShown()
              addModulesHidden()
            } else {
              //ERROR
              ipcRenderer.send('resume')
              document.getElementById('title').innerHTML = 'Error Installing Module ~3'
            }
          })
        } else {
          //NOT A MODULE (NO FOLDER)
          ipcRenderer.send('resume')
          document.getElementById('title').innerHTML = 'Error Installing Module ~2'
        }
      } else {
        //ERROR
        ipcRenderer.send('resume')
        document.getElementById('title').innerHTML = 'Error Installing Module ~1'
      }
    })
  })

  function addModulesShown() {
    if (!fs.existsSync(data.modules)) return
    document.getElementById('modulesShown').innerHTML = ''
    let modules = fs.readdirSync(data.modules)
    if (modules.includes('Settings'))  modules.splice(modules.indexOf('Settings'), 1)
    if (modules.includes('Store'))  modules.splice(modules.indexOf('Store'), 1)
    if (modules.includes('Library')) modules.splice(modules.indexOf('Library'), 1)
    if (modules.includes('Themes'))  modules.splice(modules.indexOf('Themes'), 1)
    for(i in modules) {
      //DATA
      let id = 'moduleShown'+i
      let name = modules[i]
      let path = data.modules+name
      let html = `<div id="${id}" class="button buttonText" style="width: 130px; min-height: 40px; height: 40px; margin-top: 20px;">
                      ${name}
                      <div id="${'path-'+id}" style="display: none;">${path}</div>
                    </div>`
      //ADD MODULE
      document.getElementById('modulesShown').insertAdjacentHTML('beforeend', html)
      addButtonListener(id, function() {
        if (modulesRemoving) {
          document.getElementById('modulesRemoveTitle').innerHTML = 'Remove "'+name+'"?'
          document.getElementById('modulesRemovePath').innerHTML = data.modules+name
          document.getElementById('modulesRemove').style.display = 'flex'
        } else {
          if (fs.existsSync(data.modulesHidden+name)) {
            document.getElementById('modulesLog').innerHTML = 'Module Already Exists'
            return
          }
          fs.rename(data.modules+name, data.modulesHidden+name, function(err) {
            if (err) document.getElementById('modulesLog').innerHTML = err
            else document.getElementById('modulesLog').innerHTML = 'Restart Needed'
            addModulesShown()
            addModulesHidden()
          })
        }
      })
    }
  }

  function addModulesHidden() {
    if (!fs.existsSync(data.modulesHidden)) return
    document.getElementById('modulesHidden').innerHTML = ''
    let modules = fs.readdirSync(data.modulesHidden)
    if (modules.includes('Settings'))  modules.splice(modules.indexOf('Settings'), 1)
    if (modules.includes('Store'))  modules.splice(modules.indexOf('Store'), 1)
    if (modules.includes('Library')) modules.splice(modules.indexOf('Library'), 1)
    if (modules.includes('Themes'))  modules.splice(modules.indexOf('Themes'), 1)
    for(i in modules) {
      //DATA
      let id = 'moduleHidden'+i
      let name = modules[i]
      let path = data.modulesHidden+name
      let html = `<div id="${id}" class="button buttonText" style="width: 130px; min-height: 40px; height: 40px; margin-top: 20px;">
                      ${name}
                      <div id="${'path-'+id}" style="display: none;">${path}</div>
                    </div>`
      //ADD MODULE
      document.getElementById('modulesHidden').insertAdjacentHTML('beforeend', html)
      addButtonListener(id, function() {
        if (modulesRemoving) {
          document.getElementById('modulesRemoveTitle').innerHTML = 'Remove "'+name+'"?'
          document.getElementById('modulesRemovePath').innerHTML = data.modules+name
          document.getElementById('modulesRemove').style.display = 'flex'
        } else {
          if (fs.existsSync(data.modules+name)) {
            document.getElementById('modulesLog').innerHTML = 'Module Already Exists'
            return
          }
          fs.rename(data.modulesHidden+name, data.modules+name, function(err) {
            if (err) document.getElementById('modulesLog').innerHTML = err
            else document.getElementById('modulesLog').innerHTML = 'Restart Needed'
            addModulesShown()
            addModulesHidden()
          })
        }
      })
    }
  }
</script>