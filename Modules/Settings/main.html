<div style="padding: 2%; display: flex; flex-direction: column;">
  <div style="flex-grow: 1; display: flex; align-items: center; margin-bottom: 20px;">
    <div id="title" style="padding-top: 10px; padding-bottom: 10px; color: var(--textPrimary); font-family: Special; font-size: 40px; line-height: 40px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">Settings</div>
    <div style="flex-grow: 1;"></div>
    <div id="restart" class="button buttonEmoteText" style="width: 40px; min-width: 40px; height: 40px; min-height: 40px; margin-left: 10px;">â†»</div>
  </div>
  
  <div style="flex-grow: 1; display: flex; align-items: center; margin-bottom: 10px;">
    <div style="padding-top: 10px; padding-bottom: 10px; color: var(--textPrimary); font-family: Special; font-size: 30px; line-height: 30px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">â€¢ Window</div>
    <div style="flex-grow: 1;"></div>
    <div id="windowLog" style="width: fit-content; height: 20px; font-size: 15px; line-height: 15px; margin-left: 10px; margin-right: 10px; display: flex; align-items: center; color: var(--textPrimary); font-family: Main;"></div>
    <div id="windowReset" class="button buttonText" style="width: 130px; min-width: 130px; height: 40px; min-height: 40px;">Reset Size</div>
  </div>

  <div style="flex-grow: 1; display: flex; align-items: center; margin-bottom: 10px;">
    <div style="padding-top: 10px; padding-bottom: 10px; color: var(--textPrimary); font-family: Special; font-size: 30px; line-height: 30px; text-overflow: ellipsis; white-space: nowrap; overflow: hidden;">â€¢ Modules</div>
    <div style="flex-grow: 1;"></div>
    <div id="modulesLog" style="width: fit-content; height: 20px; font-size: 15px; line-height: 15px; margin-left: 10px; margin-right: 10px; display: flex; align-items: center; color: var(--textPrimary); font-family: Main;"></div>
    <div class="button switchEmote" style="width: 80px; height: 40px; display: flex;">
      <input id="modulesSwitch" type="checkbox"/>
      <div style="width: 40px; position: absolute;"></div>
      <div class="buttonEmoteText" style="width: 40px;">ðŸ‘€</div>
      <div class="buttonEmoteText" style="width: 40px;">-</div>
    </div>
    <div id="modulesAdd" class="button buttonEmoteText" style="width: 40px; min-width: 40px; height: 40px; min-height: 40px; margin-left: 10px;">+</div>
  </div>
  <div style="flex-grow: 1; display: flex; justify-content: space-around; margin-bottom: 20px;">
    <div style="display: flex;">
      <div style="width: 170px; display: block; text-align: center; align-items: center; padding-top: 20px; padding-bottom: 20px;">
        <div style="color: var(--textPrimary); font-size: 15px; line-height: 15px; ">Shown</div>
        <div id="modulesShown" style="padding-left: 20px; padding-right: 20px;"></div>
      </div>        
      <div style="width: 1px; margin-top: 5px; margin-bottom: 5px; background-color: var(--textPrimary); opacity: 0.5;"></div>
      <div style="width: 170px; display: block; text-align: center; align-items: center; padding-top: 20px; padding-bottom: 20px;">
        <div style="color: var(--textPrimary); font-size: 15px; line-height: 15px; ">Hidden</div>
        <div id="modulesHidden" style="padding-left: 20px; padding-right: 20px;"></div>
      </div>
    </div>
  </div>
</div>

<script>
  //MODULE NAME CAN'T BE CHANGED FREELY (TRAY & MAIN.HTML) ðŸ˜¡
  modulesRemoving = false
  
  document.getElementById("modulesSwitch").checked = modulesRemoving

  addModulesShown()
  addModulesHidden()

  //RESTART
  addButtonListener('restart', function() {
    ipcRenderer.send('reloadAssistant')
  })

  //WINDOW
  addButtonListener('windowReset', function() {
    win.unmaximize()
    win.setSize(960, 550)
    win.center()
  })

  //MODULES
  addCheckboxListener('modulesSwitch', function() {
    modulesRemoving = true
  }, function() {
    modulesRemoving = false
  })

  addButtonListener('modulesAdd', function() {
    ipcRenderer.send('getFile', '', 'Module .Zip File', 'moduleFileGotten')
  })

  ipcRenderer.on('moduleFileGotten', (event, path) => {
    if (!path.toLowerCase().endsWith('.zip')) {
      document.getElementById('modulesLog').innerHTML = 'Invalid File Format'
      return
    }
    ipcRenderer.send('pause')
    let exec = require('child_process').exec
    document.getElementById('modulesLog').innerHTML = 'Installing Module...'
    exec(`"${data.zip}" l "${path}" -x!*\\*`, function (error, stdOut, stdErr) {
      if (!(error || stdErr)) {
        if (stdOut.replaceAll('\r', '').replaceAll('\n', '').endsWith('0 files, 1 folders')) { 
          exec(`"${data.zip}" x "${path}" -o"${data.modules}"`, function (error, stdOut, stdErr) {
            if (!(error || stdErr)) {
              //INSTALLED
              ipcRenderer.send('resume')
              document.getElementById('title').innerHTML = 'Module Installed'
              addModulesShown()
              addModulesHidden()
            } else {
              //ERROR
              ipcRenderer.send('resume')
              document.getElementById('title').innerHTML = 'Error Installing Module ~3'
            }
          })
        } else {
          //NOT A MODULE (NO FOLDER)
          ipcRenderer.send('resume')
          document.getElementById('title').innerHTML = 'Error Installing Module ~2'
        }
      } else {
        //ERROR
        ipcRenderer.send('resume')
        document.getElementById('title').innerHTML = 'Error Installing Module ~1'
      }
    })
  })

  function addModulesShown() {
    if (!fs.existsSync(data.modules)) return
    document.getElementById('modulesShown').innerHTML = ''
    let modules = fs.readdirSync(data.modules)
    if (modules.includes('Settings'))  modules.splice(modules.indexOf('Settings'), 1)
    if (modules.includes('Store'))  modules.splice(modules.indexOf('Store'), 1)
    if (modules.includes('Library')) modules.splice(modules.indexOf('Library'), 1)
    if (modules.includes('Themes'))  modules.splice(modules.indexOf('Themes'), 1)
    for(i in modules) {
      //DATA
      let id = 'moduleShown'+i
      let name = modules[i]
      let path = data.modules+name
      let html = `<div id="${id}" class="button buttonText" style="width: 130px; min-height: 40px; height: 40px; margin-top: 20px;">
                      ${name}
                      <div id="${'path-'+id}" style="display: none;">${path}</div>
                    </div>`
      //ADD MODULE
      document.getElementById('modulesShown').insertAdjacentHTML('beforeend', html)
      addButtonListener(id, function() {
        if (modulesRemoving) {
          const rimraf = require("rimraf")
          rimraf(data.modules+name, (err) => {
            addModulesShown()
            addModulesHidden()
          })
        } else {
          if (fs.existsSync(data.modulesHidden+name)) {
            document.getElementById('modulesLog').innerHTML = 'Module Already Exists'
            return
          }
          fs.rename(data.modules+name, data.modulesHidden+name, function(err) {
            if (err) document.getElementById('modulesLog').innerHTML = err
            else document.getElementById('modulesLog').innerHTML = 'Restart Needed'
            addModulesShown()
            addModulesHidden()
          })
        }
      })
    }
  }

  function addModulesHidden() {
    if (!fs.existsSync(data.modulesHidden)) return
    document.getElementById('modulesHidden').innerHTML = ''
    let modules = fs.readdirSync(data.modulesHidden)
    if (modules.includes('Settings'))  modules.splice(modules.indexOf('Settings'), 1)
    if (modules.includes('Store'))  modules.splice(modules.indexOf('Store'), 1)
    if (modules.includes('Library')) modules.splice(modules.indexOf('Library'), 1)
    if (modules.includes('Themes'))  modules.splice(modules.indexOf('Themes'), 1)
    for(i in modules) {
      //DATA
      let id = 'moduleHidden'+i
      let name = modules[i]
      let path = data.modulesHidden+name
      let html = `<div id="${id}" class="button buttonText" style="width: 130px; min-height: 40px; height: 40px; margin-top: 20px;">
                      ${name}
                      <div id="${'path-'+id}" style="display: none;">${path}</div>
                    </div>`
      //ADD MODULE
      document.getElementById('modulesHidden').insertAdjacentHTML('beforeend', html)
      addButtonListener(id, function() {
        if (modulesRemoving) {
          const rimraf = require("rimraf")
          rimraf(data.modulesHidden+name, (err) => {
            addModulesShown()
            addModulesHidden()
          })
        } else {
          if (fs.existsSync(data.modules+name)) {
            document.getElementById('modulesLog').innerHTML = 'Module Already Exists'
            return
          }
          fs.rename(data.modulesHidden+name, data.modules+name, function(err) {
            if (err) document.getElementById('modulesLog').innerHTML = err
            else document.getElementById('modulesLog').innerHTML = 'Restart Needed'
            addModulesShown()
            addModulesHidden()
          })
        }
      })
    }
  }
</script>