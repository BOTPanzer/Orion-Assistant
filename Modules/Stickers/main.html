<style>
  .stickerList {
    display: flex; 
    flex-wrap: wrap;
    gap: 10px;
  }
  
  .sticker {
    --stickerS: 120px;
    height: var(--stickerS);
    width: var(--stickerS);
    position: relative;
    border-radius: 10px;
    overflow: hidden;
    cursor: pointer;
  }

  .sticker > img:nth-of-type(1) {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .sticker > img:nth-of-type(2) {
    width: 25px;
    height: 25px;

    position: absolute;
    left: auto;
    right: 5px;
    top: 5px;
    bottom: auto;
    border-radius: 5px;
    z-index: 10;
    
    opacity: 0;
    transform: translateY(-25px);

    transition: opacity .2s, transform .2s;
  }

  .sticker:hover > img:nth-of-type(2),
  .sticker[fav] > img:nth-of-type(2) {
    opacity: 1;
    transform: translateY(0px);
  }

  .sticker > div:nth-last-of-type(1) {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background-color: transparent;
    transition: background-color .1s;
  }

  .sticker > div:nth-last-of-type(1):hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .sticker > div:nth-last-of-type(1):active {
    background-color: rgba(255, 255, 255, 0.2);
  }
</style>





<div class="win-c">
  <div id="title" class="win-t">
    <div class="title">Stickers</div>
    <o-rbutton id="stickersNew" ball>
      <svg viewBox="0 0 24 24">
        <path d="M18 12.75H6C5.59 12.75 5.25 12.41 5.25 12C5.25 11.59 5.59 11.25 6 11.25H18C18.41 11.25 18.75 11.59 18.75 12C18.75 12.41 18.41 12.75 18 12.75Z"/>
        <path d="M12 18.75C11.59 18.75 11.25 18.41 11.25 18V6C11.25 5.59 11.59 5.25 12 5.25C12.41 5.25 12.75 5.59 12.75 6V18C12.75 18.41 12.41 18.75 12 18.75Z"/>
      </svg>
    </o-rbutton>
    <o-rbutton id="stickersPop" ball onclick="stickersCreateWindow()">
      <svg viewBox="0 0 24 24">
        <path d="M16.19 2H7.81C4.17 2 2 4.17 2 7.81V16.18C2 19.83 4.17 22 7.81 22H16.18C19.82 22 21.99 19.83 21.99 16.19V7.81C22 4.17 19.83 2 16.19 2ZM17.25 12.33C17.25 12.74 16.91 13.08 16.5 13.08C16.09 13.08 15.75 12.74 15.75 12.33V9.31L8.03 17.03C7.88 17.18 7.69 17.25 7.5 17.25C7.31 17.25 7.12 17.18 6.97 17.03C6.68 16.74 6.68 16.26 6.97 15.97L14.69 8.25H11.67C11.26 8.25 10.92 7.91 10.92 7.5C10.92 7.09 11.26 6.75 11.67 6.75H16.5C16.91 6.75 17.25 7.09 17.25 7.5V12.33Z"/>
      </svg>
    </o-rbutton>
  </div>

  <div id="stickersList" class="stickerList">

  </div>
</div>





<script>
   /*$    /$$                             
  | $$   | $$                             
  | $$   | $$ /$$$$$$   /$$$$$$   /$$$$$$$
  |  $$ / $$/|____  $$ /$$__  $$ /$$_____/
   \  $$ $$/  /$$$$$$$| $$  \__/|  $$$$$$ 
    \  $$$/  /$$__  $$| $$       \____  $$
     \  $/  |  $$$$$$$| $$       /$$$$$$$/
      \_/    \_______/|__/      |______*/ 

  var stickers = getKey('stickers')
  var kbm = require("kbm-robot")
  var stickersPath = cModule.path
  var isWindow = typeof specialData === 'string'
  var isTyping = false


   /*$$$$$$$                              /$$     /$$                              
  | $$_____/                             | $$    |__/                              
  | $$    /$$   /$$ /$$$$$$$   /$$$$$$$ /$$$$$$   /$$  /$$$$$$  /$$$$$$$   /$$$$$$$
  | $$$$$| $$  | $$| $$__  $$ /$$_____/|_  $$_/  | $$ /$$__  $$| $$__  $$ /$$_____/
  | $$__/| $$  | $$| $$  \ $$| $$        | $$    | $$| $$  \ $$| $$  \ $$|  $$$$$$ 
  | $$   | $$  | $$| $$  | $$| $$        | $$ /$$| $$| $$  | $$| $$  | $$ \____  $$
  | $$   |  $$$$$$/| $$  | $$|  $$$$$$$  |  $$$$/| $$|  $$$$$$/| $$  | $$ /$$$$$$$/
  |__/    \______/ |__/  |__/ \_______/   \___/  |__/ \______/ |__/  |__/|______*/ 

  function stickerValid(url) {
    if (url == '') {
      createNoti('Library', 'URL is necesary')
      return false
    }
    if (stickers.list.includes(url) || stickers.favs.includes(url)) {
      createNoti('Library', 'Sticker is already saved')
      return false
    }
    if (stickers.list.includes(url) || stickers.favs.includes(url)) {
      createNoti('Library', 'Sticker is already saved')
      return false
    }
    return true
  }

  function saveSticker(dialogid, fav) {
    //Get sticker URL
    let url = document.getElementById('stickersURL').value.trim()

    //Check if valid
    if (!stickerValid(url)) return

    //Save it
    if (fav) stickers.favs.splice(0, 0, url)
    else stickers.list.splice(0, 0, url)
    setKey('stickers', stickers)
    closeDialog(dialogid)
    createList()
  }

  function createList() {
    //Get list & clear items
    const stickersList = document.getElementById('stickersList')
    stickersList.innerHTML = ''

    //Add stickers
    for (let i = 0; i < stickers.favs.length; i++) addStickerToList(stickersList, true, i)
    for (let i = 0; i < stickers.list.length; i++) addStickerToList(stickersList, false, i)
  }

  function addStickerToList(parent, isFav, i) {
    //Get url
    const list = isFav ? stickers.favs : stickers.list
    const url = list[i]
    const listOther = isFav ? stickers.list : stickers.favs

    //Create sticker
    let sticker = document.createElement('div')
    sticker.classList.add('sticker')
    if (isFav) sticker.setAttribute('fav', '')

    //Add listeners
    sticker.onclick = () => { 
      //Copy url & minimize window
      isTyping = true
      navigator.clipboard.writeText(url)
      kbm.startJar()
      setTimeout(() => {
        win.minimize()
        kbm.sleep(100)
          .press("CTRL").press("V")
          .release("CTRL").release("V")
          .press("ENTER").release("ENTER")
          .go().then(() => {
            kbm.stopJar()
            closeWindow()
          } );
      }, 50)
    }
    sticker.oncontextmenu = () => { 
      //Create dialog
      let dialogid = createDialog(fs.readFileSync(stickersPath + 'context.html').toString(), 'Sticker')
      
      //Update dialog
      document.getElementById('sContextURL').value = url
      
      //Add listeners
      clickListener('sContextRemove', function() {
        list.splice(i, 1)
        setKey('stickers', stickers)
        closeDialog(dialogid)
        createList()
      })

      clickListener('sContextSave', function() {
        //Get sticker URL
        let newurl = document.getElementById('sContextURL').value.trim()

        //Check if valid
        if (!stickerValid(newurl)) return
        
        //Save
        list[i] = newurl
        setKey('stickers', stickers)
        closeDialog(dialogid)
        createList()
      })
    }

    //Add image
    let img = document.createElement('img')
    img.src = url
    sticker.append(img)

    //Add star
    let star = document.createElement('img')
    star.src = stickersPath + (isFav ? 'star.png' : 'star-border.png')
    star.onclick = (event) => { 
      //Toggle favorite
      event.stopPropagation()
      listOther.splice(0, 0, url)
      list.splice(i, 1)
      setKey('stickers', stickers)
      createList()
    }
    
    sticker.append(star)

    //Add hover/click overlay
    let overlay = document.createElement('div')
    sticker.append(overlay)

    //Add sticker to list
    parent.append(sticker)
  }


   /*$       /$$             /$$                                                      
  | $$      |__/            | $$                                                      
  | $$       /$$  /$$$$$$$ /$$$$$$    /$$$$$$  /$$$$$$$   /$$$$$$   /$$$$$$   /$$$$$$$
  | $$      | $$ /$$_____/|_  $$_/   /$$__  $$| $$__  $$ /$$__  $$ /$$__  $$ /$$_____/
  | $$      | $$|  $$$$$$   | $$    | $$$$$$$$| $$  \ $$| $$$$$$$$| $$  \__/|  $$$$$$ 
  | $$      | $$ \____  $$  | $$ /$$| $$_____/| $$  | $$| $$_____/| $$       \____  $$
  | $$$$$$$$| $$ /$$$$$$$/  |  $$$$/|  $$$$$$$| $$  | $$|  $$$$$$$| $$       /$$$$$$$/
  |________/|__/|_______/    \___/   \_______/|__/  |__/ \_______/|__/      |______*/ 

  clickListener('stickersNew', function() {
    let dialogid = createDialog(fs.readFileSync(stickersPath + 'add.html').toString(), 'Add sticker')
    
    clickListener('stickersAdd', function() {
      saveSticker(dialogid, false)
    })

    clickListener('stickersFav', function() {
      saveSticker(dialogid, true)
    })
  })

  if (isWindow) window.onblur = () => { if (!isTyping) closeWindow() }


    /*$$$$$                  /$$          
   /$$__  $$                | $$          
  | $$  \__/  /$$$$$$   /$$$$$$$  /$$$$$$ 
  | $$       /$$__  $$ /$$__  $$ /$$__  $$
  | $$      | $$  \ $$| $$  | $$| $$$$$$$$
  | $$    $$| $$  | $$| $$  | $$| $$_____/
  |  $$$$$$/|  $$$$$$/|  $$$$$$$|  $$$$$$$
   \______/  \______/  \_______/ \______*/
  
  //Check if window
  if (isWindow) {
    document.getElementById('stickersPop').style.display = 'none'
    stickersPath = specialData
    renameWindow("Stickers") 
    //win.openDevTools()
  }

  //Fix settings key
  if (stickers == undefined) {
    stickers = { 
      favs: [],
      list: [],
    }
    setKey('stickers', stickers)
  }
  if (!Array.isArray(stickers.favs)) {
    stickers.favs = []
    setKey('stickers', stickers)
  }
  if (!Array.isArray(stickers.list)) {
    stickers.list = []
    setKey('stickers', stickers)
  }

  //Create stickers
  createList()
</script>